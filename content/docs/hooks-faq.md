---
id: hooks-faq
title: ãƒ•ãƒƒã‚¯ã«é–¢ã™ã‚‹ã‚ˆãã‚ã‚‹è³ªå•
permalink: docs/hooks-faq.html
prev: hooks-reference.html
---

*ãƒ•ãƒƒã‚¯ (hook)* ã¯ React 16.8 ã§è¿½åŠ ã•ã‚ŒãŸæ–°æ©Ÿèƒ½ã§ã™ã€‚state ãªã©ã® React ã®æ©Ÿèƒ½ã‚’ã€ã‚¯ãƒ©ã‚¹ã‚’æ›¸ã‹ãšã«ä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

ã“ã®ãƒšãƒ¼ã‚¸ã§ã¯[ãƒ•ãƒƒã‚¯](/docs/hooks-overview.html)ã«é–¢ã™ã‚‹ã‚ˆãã‚ã‚‹è³ªå•ã«ã„ãã¤ã‹ãŠç­”ãˆã—ã¾ã™ã€‚

<!--
  if you ever need to regenerate this, this snippet in the devtools console might help:

  $$('.anchor').map(a =>
    `${' '.repeat(2 * +a.parentNode.nodeName.slice(1))}` +
    `[${a.parentNode.textContent}](${a.getAttribute('href')})`
  ).join('\n')
-->

* **[å°å…¥ã®æŒ‡é‡](#adoption-strategy)**
  * [ãƒ•ãƒƒã‚¯ãŒä½¿ãˆã‚‹ React ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ã©ã‚Œã§ã™ã‹ï¼Ÿ](#which-versions-of-react-include-hooks)
  * [ã‚¯ãƒ©ã‚¹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å…¨éƒ¨æ›¸ãæ›ãˆã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ã™ã‹ï¼Ÿ](#do-i-need-to-rewrite-all-my-class-components)
  * [ã‚¯ãƒ©ã‚¹ã§ã¯ã§ããšã€ãƒ•ãƒƒã‚¯ã§ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã“ã¨ã¯ä½•ã§ã™ã‹ï¼Ÿ](#what-can-i-do-with-hooks-that-i-couldnt-with-classes)
  * [ã“ã‚Œã¾ã§ã® React ã®çŸ¥è­˜ã¯ã©ã®ç¨‹åº¦ä½¿ãˆã¾ã™ã‹ï¼Ÿ](#how-much-of-my-react-knowledge-stays-relevant)
  * [ãƒ•ãƒƒã‚¯ã€ã‚¯ãƒ©ã‚¹ã®ã„ãšã‚Œã‚’ä½¿ã†ã¹ãã§ã™ã‹ã€ã‚ã‚‹ã„ã¯ãã®ä¸¡æ–¹ã§ã—ã‚‡ã†ã‹ï¼Ÿ](#should-i-use-hooks-classes-or-a-mix-of-both)
  * [ãƒ•ãƒƒã‚¯ã¯ã‚¯ãƒ©ã‚¹ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®ã™ã¹ã¦ã‚’ã‚«ãƒãƒ¼ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ](#do-hooks-cover-all-use-cases-for-classes)
  * [ãƒ•ãƒƒã‚¯ã¯ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ—ãƒ­ãƒƒãƒ—ã‚„é«˜éšã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç½®ãæ›ãˆã‚‹ã‚‚ã®ã§ã™ã‹ï¼Ÿ](#do-hooks-replace-render-props-and-higher-order-components)
  * [Redux ã® connect() ã‚„ React Router ã¨ã„ã£ãŸäººæ°—ã® API ã¯ãƒ•ãƒƒã‚¯ã«ã‚ˆã‚Šã©ã†ãªã‚Šã¾ã™ã‹ï¼Ÿ](#what-do-hooks-mean-for-popular-apis-like-redux-connect-and-react-router)
  * [ãƒ•ãƒƒã‚¯ã¯é™çš„å‹ä»˜ã‘ã¨çµ„ã¿åˆã‚ã›ã¦ã†ã¾ãå‹•ãã¾ã™ã‹ï¼Ÿ](#do-hooks-work-with-static-typing)
  * [ãƒ•ãƒƒã‚¯ã‚’ä½¿ã£ãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ã©ã®ã‚ˆã†ã«ãƒ†ã‚¹ãƒˆã™ã‚‹ã®ã§ã™ã‹ï¼Ÿ](#how-to-test-components-that-use-hooks)
  * [Lint ãƒ«ãƒ¼ãƒ«ã¯å…·ä½“çš„ã«ä½•ã‚’å¼·åˆ¶ã™ã‚‹ã®ã§ã™ã‹ï¼Ÿ](#what-exactly-do-the-lint-rules-enforce)
* **[ã‚¯ãƒ©ã‚¹ã‹ã‚‰ãƒ•ãƒƒã‚¯ã¸](#from-classes-to-hooks)**
  * [å€‹ã€…ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒ¡ã‚½ãƒƒãƒ‰ã¯ãƒ•ãƒƒã‚¯ã¨ã©ã®ã‚ˆã†ã«å¯¾å¿œã™ã‚‹ã®ã§ã™ã‹ï¼Ÿ](#how-do-lifecycle-methods-correspond-to-hooks)
  * [ãƒ•ãƒƒã‚¯ã§ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã‚’ã©ã®ã‚ˆã†ã«è¡Œã†ã®ã§ã™ã‹ï¼Ÿ](#how-can-i-do-data-fetching-with-hooks)
  * [ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å¤‰æ•°ã®ã‚ˆã†ãªã‚‚ã®ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ](#is-there-something-like-instance-variables)
  * [state å¤‰æ•°ã¯ 1 ã¤ã«ã™ã¹ãã§ã™ã‹ã€ãŸãã•ã‚“ä½¿ã†ã¹ãã§ã™ã‹ï¼Ÿ](#should-i-use-one-or-many-state-variables)
  * [ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®æ›´æ–°ã®ã¨ãã ã‘å‰¯ä½œç”¨ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã¯å¯èƒ½ã§ã™ã‹ï¼Ÿ](#can-i-run-an-effect-only-on-updates)
  * [å‰å›ã® props ã‚„ state ã¯ã©ã†ã™ã‚Œã°å–å¾—ã§ãã¾ã™ã‹ï¼Ÿ](#how-to-get-the-previous-props-or-state)
  * [é–¢æ•°å†…ã§å¤ã„ props ã‚„ state ãŒè¦‹ãˆã¦ã„ã‚‹ã®ã¯ãªãœã§ã™ã‹ï¼Ÿ](#why-am-i-seeing-stale-props-or-state-inside-my-function)
  * [ã©ã†ã™ã‚Œã° getDerivedStateFromProps ã‚’å®Ÿè£…ã§ãã¾ã™ã‹ï¼Ÿ](#how-do-i-implement-getderivedstatefromprops)
  * [forceUpdate ã®ã‚ˆã†ãªã‚‚ã®ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ](#is-there-something-like-forceupdate)
  * [é–¢æ•°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¸ã® ref ã‚’ä½œã‚‹ã“ã¨ã¯å¯èƒ½ã§ã™ã‹ï¼Ÿ](#can-i-make-a-ref-to-a-function-component)
  * [DOM ãƒãƒ¼ãƒ‰ã®ä½ç½®ã‚„ã‚µã‚¤ã‚ºã®æ¸¬å®šã¯ã©ã®ã‚ˆã†ã«è¡Œã†ã®ã§ã™ã‹ï¼Ÿ](#how-can-i-measure-a-dom-node)
  * [const [thing, setThing] = useState() ã¨ã„ã†ã®ã¯ã©ã†ã„ã†æ„å‘³ã§ã™ã‹ï¼Ÿ](#what-does-const-thing-setthing--usestate-mean)
* **[ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–](#performance-optimizations)**
  * [æ›´æ–°æ™‚ã«å‰¯ä½œç”¨ã‚’ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã™ã‹ï¼Ÿ](#can-i-skip-an-effect-on-updates)
  * [ä¾å­˜ã®é…åˆ—ã‹ã‚‰é–¢æ•°ã‚’çœç•¥ã—ã¦ã‚‚å¤§ä¸ˆå¤«ã§ã™ã‹ï¼Ÿ](#is-it-safe-to-omit-functions-from-the-list-of-dependencies)
  * [å‰¯ä½œç”¨ã®ä¾å­˜ãƒªã‚¹ãƒˆãŒé »ç¹ã«å¤‰ã‚ã‚Šã™ãã‚‹å ´åˆã¯ã©ã†ã™ã‚Œã°ã‚ˆã„ã§ã™ã‹ï¼Ÿ](#what-can-i-do-if-my-effect-dependencies-change-too-often)
  * [ã©ã†ã™ã‚Œã° `shouldComponentUpdate` ã‚’å®Ÿè£…ã§ãã¾ã™ã‹ï¼Ÿ](#how-do-i-implement-shouldcomponentupdate)
  * [è¨ˆç®—çµæœã®ãƒ¡ãƒ¢åŒ–ã¯ã©ã®ã‚ˆã†ã«è¡Œã†ã®ã§ã™ã‹ï¼Ÿ](#how-to-memoize-calculations)
  * [è¨ˆç®—é‡ã®å¤§ãã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆã‚’é…å»¶ã™ã‚‹æ–¹æ³•ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ](#how-to-create-expensive-objects-lazily)
  * [ãƒ¬ãƒ³ãƒ€ãƒ¼å†…ã§é–¢æ•°ã‚’ä½œã‚‹ã›ã„ã§ãƒ•ãƒƒã‚¯ã¯é…ããªã‚‹ã®ã§ã¯ãªã„ã§ã™ã‹ï¼Ÿ](#are-hooks-slow-because-of-creating-functions-in-render)
  * [ã©ã†ã™ã‚Œã°è¤‡æ•°ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’æ·±ãå—ã‘æ¸¡ã™ã®ã‚’å›é¿ã§ãã¾ã™ã‹ï¼Ÿ](#how-to-avoid-passing-callbacks-down)
  * [useCallback ã‹ã‚‰ã®é »ç¹ã«å¤‰ã‚ã‚‹å€¤ã‚’èª­ã¿å‡ºã™æ–¹æ³•ã¯ï¼Ÿ](#how-to-read-an-often-changing-value-from-usecallback)
* **[å†…éƒ¨ã®ä»•çµ„ã¿](#under-the-hood)**
  * [React ã¯ãƒ•ãƒƒã‚¯å‘¼ã³å‡ºã—ã¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã‚’ã©ã®ã‚ˆã†ã«é–¢é€£ä»˜ã‘ã¦ã„ã‚‹ã®ã§ã™ã‹ï¼Ÿ](#how-does-react-associate-hook-calls-with-components)
  * [ãƒ•ãƒƒã‚¯ã®å…ˆè¡ŒæŠ€è¡“ã«ã¯ã©ã®ã‚ˆã†ãªã‚‚ã®ãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿ](#what-is-the-prior-art-for-hooks)

## å°å…¥ã®æŒ‡é‡ {#adoption-strategy}

### ãƒ•ãƒƒã‚¯ãŒä½¿ãˆã‚‹ React ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ã©ã‚Œã§ã™ã‹ï¼Ÿ {#which-versions-of-react-include-hooks}

React ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 16.8.0 ã‚ˆã‚Šã€ä»¥ä¸‹ã«ãŠã„ã¦ãƒ•ãƒƒã‚¯ã®å®‰å®šç‰ˆã®å®Ÿè£…ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

* React DOM
* React Native
* React DOM Server
* React Test Renderer
* React Shallow Renderer

**ãƒ•ãƒƒã‚¯ã‚’åˆ©ç”¨ã™ã‚‹ã«ã¯ã€ã™ã¹ã¦ã® React ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒ 16.8.0 ä»¥ä¸Šã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™**ã€‚ä¾‹ãˆã° React DOM ã®æ›´æ–°ã‚’å¿˜ã‚ŒãŸå ´åˆã€ãƒ•ãƒƒã‚¯ã¯å‹•ä½œã—ã¾ã›ã‚“ã€‚

React Native ã¯[ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 0.59](https://facebook.github.io/react-native/blog/2019/03/12/releasing-react-native-059) ä»¥é™ã§ãƒ•ãƒƒã‚¯ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚

### ã‚¯ãƒ©ã‚¹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å…¨éƒ¨æ›¸ãæ›ãˆã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ã™ã‹ï¼Ÿ {#do-i-need-to-rewrite-all-my-class-components}

ã„ã„ãˆã€‚React ã‹ã‚‰ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤ã™ã‚‹[äºˆå®šã¯ã‚ã‚Šã¾ã›ã‚“](/docs/hooks-intro.html#gradual-adoption-strategy) -- æˆ‘ã€…ã¯ã¿ãªãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã‚’ä¸–ã«å‡ºã—ç¶šã‘ã‚‹å¿…è¦ãŒã‚ã‚Šã€ã‚¯ãƒ©ã‚¹ã‚’æ›¸ãæ›ãˆã¦ã„ã‚‹ä½™è£•ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚æ–°ã—ã„ã‚³ãƒ¼ãƒ‰ã§ãƒ•ãƒƒã‚¯ã‚’è©¦ã™ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚

### ã‚¯ãƒ©ã‚¹ã§ã¯ã§ããšã€ãƒ•ãƒƒã‚¯ã§ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã“ã¨ã¯ä½•ã§ã™ã‹ï¼Ÿ {#what-can-i-do-with-hooks-that-i-couldnt-with-classes}

ãƒ•ãƒƒã‚¯ã«ã‚ˆã‚Šã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“ã§æ©Ÿèƒ½ã‚’å†åˆ©ç”¨ã™ã‚‹ãŸã‚ã®ãƒ‘ãƒ¯ãƒ•ãƒ«ã§è¡¨ç¾åŠ›ã®é«˜ã„æ‰‹æ®µãŒå¾—ã‚‰ã‚Œã¾ã™ã€‚["ç‹¬è‡ªãƒ•ãƒƒã‚¯ã®ä½œæˆ"](/docs/hooks-custom.html)ã‚’èª­ã‚ã°ã§ãã‚‹ã“ã¨ã®æ¦‚è¦ãŒæ´ã‚ã‚‹ã§ã—ã‚‡ã†ã€‚React ã®ã‚³ã‚¢ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã«ã‚ˆã£ã¦æ›¸ã‹ã‚ŒãŸ[ã“ã®è¨˜äº‹](https://medium.com/@dan_abramov/making-sense-of-react-hooks-fdbde8803889)ã«ã‚ˆã‚Šã€ãƒ•ãƒƒã‚¯ã«ã‚ˆã£ã¦æ–°ãŸã«ã‚‚ãŸã‚‰ã•ã‚Œã‚‹å¯èƒ½æ€§ã«ã¤ã„ã¦ã®æ´å¯ŸãŒå¾—ã‚‰ã‚Œã¾ã™ã€‚

### ã“ã‚Œã¾ã§ã® React ã®çŸ¥è­˜ã¯ã©ã®ç¨‹åº¦ä½¿ãˆã¾ã™ã‹ï¼Ÿ {#how-much-of-my-react-knowledge-stays-relevant}

ãƒ•ãƒƒã‚¯ã¨ã¯ã€state ã‚„ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã€ã‚³ãƒ³ãƒ†ã‚¯ã‚¹ãƒˆã‚„ ref ã¨ã„ã£ãŸã€ã‚ãªãŸãŒæ—¢ã«çŸ¥ã£ã¦ã„ã‚‹ React ã®æ©Ÿèƒ½ã‚’ã‚ˆã‚Šç›´æ¥çš„ã«åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹æ‰‹æ®µã§ã™ã€‚React ã®å‹•ä½œãŒæ ¹æœ¬çš„ã«å¤‰ã‚ã‚‹ã‚ˆã†ãªã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã—ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚„ propsã€ãƒˆãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã®ãƒ‡ãƒ¼ã‚¿ã®æµã‚Œã«ã¤ã„ã¦ã®çŸ¥è­˜ã¯ã“ã‚Œã¾ã§ã¨åŒæ§˜ã«é‡è¦ã§ã™ã€‚

ã‚‚ã¡ã‚ã‚“ãƒ•ãƒƒã‚¯ã«ã¯ãƒ•ãƒƒã‚¯ãªã‚Šã®å­¦ç¿’æ›²ç·šãŒã‚ã‚Šã¾ã™ã€‚ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«è¶³ã‚Šãªã„ã“ã¨ã‚’è¦‹ã¤ã‘ãŸã‚‰ [Issue ã‚’å ±å‘Š](https://github.com/reactjs/reactjs.org/issues/new)ã—ã¦ã„ãŸã ã‘ã‚Œã°ã€ãŠæ‰‹ä¼ã„ã—ã¾ã™ã€‚

### ãƒ•ãƒƒã‚¯ã€ã‚¯ãƒ©ã‚¹ã®ã„ãšã‚Œã‚’ä½¿ã†ã¹ãã§ã™ã‹ã€ã‚ã‚‹ã„ã¯ãã®ä¸¡æ–¹ã§ã—ã‚‡ã†ã‹ï¼Ÿ {#should-i-use-hooks-classes-or-a-mix-of-both}

æº–å‚™ãŒã§ãã—ã ã„ã€æ–°ã—ã„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ãƒ•ãƒƒã‚¯ã‚’è©¦ã™ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚ãƒãƒ¼ãƒ ã®å…¨å“¡ã®æº–å‚™ãŒå®Œäº†ã—ã€ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«é¦´æŸ“ã‚“ã§ã„ã‚‹ã“ã¨ã‚’ç¢ºã‹ã‚ã¾ã—ã‚‡ã†ã€‚ï¼ˆä¾‹ãˆã°ãƒã‚°ã‚’ç›´ã™ãªã©ã®ç†ç”±ã§ï¼‰ä½•ã«ã›ã‚ˆæ›¸ãæ›ãˆã‚‹äºˆå®šã®å ´åˆã‚’é™¤ã„ã¦ã¯ã€æ—¢å­˜ã®ã‚¯ãƒ©ã‚¹ã‚’ãƒ•ãƒƒã‚¯ã«æ›¸ãæ›ãˆã‚‹ã“ã¨ã¯ãŠå‹§ã‚ã—ã¾ã›ã‚“ã€‚

ã‚¯ãƒ©ã‚¹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®*å®šç¾©å†…ã§*ãƒ•ãƒƒã‚¯ã‚’ä½¿ã†ã“ã¨ã¯ã§ãã¾ã›ã‚“ãŒã€ã‚¯ãƒ©ã‚¹å‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ãƒ•ãƒƒã‚¯ã‚’ä½¿ã£ãŸé–¢æ•°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã‚’ 1 ã¤ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ„ãƒªãƒ¼å†…ã§æ··åœ¨ã•ã›ã‚‹ã“ã¨ã¯å…¨ãå•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚ã‚ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã‚¯ãƒ©ã‚¹ã§æ›¸ã‹ã‚Œã¦ã„ã‚‹ã‹ãƒ•ãƒƒã‚¯ã‚’ç”¨ã„ãŸé–¢æ•°ã§æ›¸ã‹ã‚Œã¦ã„ã‚‹ã‹ã¨ã„ã†ã®ã¯ã€ãã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å®Ÿè£…ã®è©³ç´°ã§ã™ã€‚é•·æœŸçš„ã«ã¯ã€ãƒ•ãƒƒã‚¯ãŒ React ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æ›¸ãéš›ã®ç¬¬ä¸€é¸æŠã¨ãªã‚‹ã“ã¨ã‚’æœŸå¾…ã—ã¦ã„ã¾ã™ã€‚

### ãƒ•ãƒƒã‚¯ã¯ã‚¯ãƒ©ã‚¹ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®ã™ã¹ã¦ã‚’ã‚«ãƒãƒ¼ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ {#do-hooks-cover-all-use-cases-for-classes}

æˆ‘ã€…ã®ç›®æ¨™ã¯ã§ãã‚‹ã ã‘æ—©æ€¥ã«ãƒ•ãƒƒã‚¯ãŒã™ã¹ã¦ã®ã‚¯ãƒ©ã‚¹ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã‚’ã‚«ãƒãƒ¼ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§ã™ã€‚ã¾ã ä½¿ç”¨é »åº¦ã®ä½ã„ `getSnapshotBeforeUpdate` ã¨ `componentDidCatch` ã«ã¤ã„ã¦ã¯ãƒ•ãƒƒã‚¯ã§ã®åŒç­‰ç‰©ãŒå­˜åœ¨ã—ã¦ã„ã¾ã›ã‚“ãŒã€ã™ãã«è¿½åŠ ã™ã‚‹äºˆå®šã§ã™ã€‚

ã¾ã ãƒ•ãƒƒã‚¯ã¯ã§ããŸã°ã‹ã‚Šã§ã™ã®ã§ã€å¹¾ã¤ã‹ã®ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£è£½ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ç¾æ™‚ç‚¹ã§ãƒ•ãƒƒã‚¯ã¨ã®äº’æ›æ€§ãŒãªã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

### ãƒ•ãƒƒã‚¯ã¯ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ—ãƒ­ãƒƒãƒ—ã‚„é«˜éšã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç½®ãæ›ãˆã‚‹ã‚‚ã®ã§ã™ã‹ï¼Ÿ {#do-hooks-replace-render-props-and-higher-order-components}

ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ—ãƒ­ãƒƒãƒ—ã‚„é«˜éšã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ã€ã²ã¨ã¤ã®å­ã ã‘ã‚’ãƒ¬ãƒ³ãƒ€ãƒ¼ã™ã‚‹ã“ã¨ãŒã‚ˆãã‚ã‚Šã¾ã™ã€‚ãƒ•ãƒƒã‚¯ã¯ã“ã®ã‚ˆã†ãªãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã‚’å®Ÿç¾ã™ã‚‹ã‚ˆã‚Šç°¡å˜ãªæ‰‹æ®µã ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚‰ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã¯å¼•ãç¶šãåˆ©ç”¨ã™ã¹ãå ´é¢ãŒã‚ã‚Šã¾ã™ï¼ˆä¾‹ãˆã°ã€ãƒãƒ¼ãƒãƒ£ãƒ«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ©ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ `renderItem` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’æŒã¤ã§ã—ã‚‡ã†ã—ã€ã‚³ãƒ³ãƒ†ãƒŠã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯è‡ªåˆ†è‡ªèº«ã® DOM æ§‹é€ ã‚’æœ‰ã—ã¦ã„ã‚‹ã§ã—ã‚‡ã†ï¼‰ã€‚ã¨ã¯ã„ãˆå¤§æŠµã®å ´åˆã§ã¯ãƒ•ãƒƒã‚¯ã§ååˆ†ã§ã‚ã‚Šã€ãƒ•ãƒƒã‚¯ãŒãƒ„ãƒªãƒ¼ã®ãƒã‚¹ãƒˆã‚’æ¸›ã‚‰ã™ã®ã«å½¹ç«‹ã¤ã§ã—ã‚‡ã†ã€‚

### Redux ã® `connect()` ã‚„ React Router ã¨ã„ã£ãŸäººæ°—ã® API ã¯ãƒ•ãƒƒã‚¯ã«ã‚ˆã‚Šã©ã†ãªã‚Šã¾ã™ã‹ï¼Ÿ {#what-do-hooks-mean-for-popular-apis-like-redux-connect-and-react-router}

ã“ã‚Œã¾ã§ã¨åŒæ§˜ã«å…¨ãåŒã˜ API ã‚’ä½¿ç”¨ã—ç¶šã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãã‚Œã‚‰ã¯å‹•ä½œã—ç¶šã‘ã¾ã™ã€‚

React Redux ã¯ v7.1.0 ã‚ˆã‚Š [ãƒ•ãƒƒã‚¯ API ã‚’ã‚µãƒãƒ¼ãƒˆ](https://react-redux.js.org/api/hooks)ã—ã¦ãŠã‚Šã€`useDispatch` ã‚„ `useSelector` ã¨ã„ã£ãŸãƒ•ãƒƒã‚¯ã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚

React Router ã¯ v5.1 ã‚ˆã‚Š [ãƒ•ãƒƒã‚¯ API ã‚’ã‚µãƒãƒ¼ãƒˆ](https://reacttraining.com/react-router/web/api/Hooks) ã—ã¦ã„ã¾ã™ã€‚

ä»–ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚‚ã€å°†æ¥çš„ã«ãƒ•ãƒƒã‚¯ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

### ãƒ•ãƒƒã‚¯ã¯é™çš„å‹ä»˜ã‘ã¨çµ„ã¿åˆã‚ã›ã¦ã†ã¾ãå‹•ãã¾ã™ã‹ï¼Ÿ {#do-hooks-work-with-static-typing}

ãƒ•ãƒƒã‚¯ã¯é™çš„å‹ä»˜ã‘ã‚’å¿µé ­ã«è¨­è¨ˆã•ã‚Œã¾ã—ãŸã€‚ãƒ•ãƒƒã‚¯ã¯é–¢æ•°ã§ã™ã®ã§ã€é«˜éšã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚ˆã†ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã¨æ¯”è¼ƒã—ã¦ã‚‚æ­£ã—ãå‹ä»˜ã‘ã™ã‚‹ã®ã¯å®¹æ˜“ã§ã™ã€‚æœ€æ–°ç‰ˆã® Flow ã¨ TypeScript ã«ãŠã‘ã‚‹ React ã®å‹å®šç¾©ã«ã¯ã€React ã®ãƒ•ãƒƒã‚¯ã«ã¤ã„ã¦ã®ã‚µãƒãƒ¼ãƒˆãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

é‡è¦ãªã“ã¨ã§ã™ãŒã€ã‚‚ã—ã‚ˆã‚Šå³å¯†ã«å‹ä»˜ã‘ã—ãŸã„å ´åˆã¯ã€ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã‚’ä½¿ã†ã“ã¨ã§ React API ã«ä½•ã‚‰ã‹ã®åˆ¶ç´„ã‚’åŠ ãˆã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚React ã¯åŸºæœ¬éƒ¨å“ã‚’æä¾›ã—ã¾ã™ãŒã€æœ€åˆã‹ã‚‰æä¾›ã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã¨é•ã†æ–¹æ³•ã§ãã‚Œã‚‰ã‚’æ§˜ã€…ã«çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### ãƒ•ãƒƒã‚¯ã‚’ä½¿ã£ãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ã©ã®ã‚ˆã†ã«ãƒ†ã‚¹ãƒˆã™ã‚‹ã®ã§ã™ã‹ï¼Ÿ {#how-to-test-components-that-use-hooks}

React ã®è¦³ç‚¹ã‹ã‚‰è¦‹ã‚Œã°ã€ãƒ•ãƒƒã‚¯ã‚’ä½¿ã£ãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯å˜ãªã‚‹æ™®é€šã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã™ã€‚ã‚ãªãŸã®ãƒ†ã‚¹ãƒˆã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ãŒ React ã®å†…éƒ¨å‹•ä½œã«ä¾å­˜ã—ã¦ã„ã‚‹ã®ã§ãªã„å ´åˆã€ãƒ•ãƒƒã‚¯ã‚’ä½¿ã£ãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆã®ã‚„ã‚Šæ–¹ã¯ã€ã‚ãªãŸãŒæ™®æ®µã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ãƒ†ã‚¹ãƒˆã—ã¦ã„ã‚‹ã‚„ã‚Šæ–¹ã¨å¤‰ã‚ã‚‰ãªã„ã¯ãšã§ã™ã€‚

> è£œè¶³
>
> [ãƒ†ã‚¹ãƒˆã®ãƒ¬ã‚·ãƒ”é›†](/docs/testing-recipes.html) ã«ã‚³ãƒ”ãƒ¼ãƒ»ãƒšãƒ¼ã‚¹ãƒˆã§ä½¿ãˆã‚‹ãŸãã•ã‚“ã®ä¾‹ãŒæ²è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚

ä¾‹ãˆã°ã“ã®ã‚ˆã†ãªã‚«ã‚¦ãƒ³ã‚¿ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã‚ã‚‹ã¨ã—ã¾ã—ã‚‡ã†ï¼š

```js
function Example() {
  const [count, setCount] = useState(0);
  useEffect(() => {
    document.title = `You clicked ${count} times`;
  });
  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>
        Click me
      </button>
    </div>
  );
}
```

ã“ã‚Œã‚’ React DOM ã‚’ä½¿ã£ã¦ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã§ã®æŒ™å‹•ã¨ç¢ºå®Ÿã«åˆè‡´ã•ã›ã‚‹ãŸã‚ã€ã“ã‚Œã‚’ãƒ¬ãƒ³ãƒ€ãƒ¼ã—ãŸã‚Šæ›´æ–°ã—ãŸã‚Šã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’ [`ReactTestUtils.act()`](/docs/test-utils.html#act) ã§ãƒ©ãƒƒãƒ—ã—ã¾ã™ï¼š

```js{3,20-22,29-31}
import React from 'react';
import ReactDOM from 'react-dom';
import { act } from 'react-dom/test-utils';
import Counter from './Counter';

let container;

beforeEach(() => {
  container = document.createElement('div');
  document.body.appendChild(container);
});

afterEach(() => {
  document.body.removeChild(container);
  container = null;
});

it('can render and update a counter', () => {
  // Test first render and effect
  act(() => {
    ReactDOM.render(<Counter />, container);
  });
  const button = container.querySelector('button');
  const label = container.querySelector('p');
  expect(label.textContent).toBe('You clicked 0 times');
  expect(document.title).toBe('You clicked 0 times');

  // Test second render and effect
  act(() => {
    button.dispatchEvent(new MouseEvent('click', {bubbles: true}));
  });
  expect(label.textContent).toBe('You clicked 1 times');
  expect(document.title).toBe('You clicked 1 times');
});
```

`act()` ã‚’å‘¼ã³å‡ºã™ã¨å†…éƒ¨ã®å‰¯ä½œç”¨ã‚‚å‡¦ç†ã•ã‚Œã¾ã™ã€‚

ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã‚’ãƒ†ã‚¹ãƒˆã—ãŸã„å ´åˆã¯ã€ãƒ†ã‚¹ãƒˆå†…ã§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œã£ã¦ä¸­ã§ãã®ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã‚’ä½¿ã†ã‚ˆã†ã«ã—ã¦ãã ã•ã„ã€‚ãã†ã™ã‚Œã°ãã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ãƒ†ã‚¹ãƒˆã§ãã¾ã™ã€‚

ãƒœã‚¤ãƒ©ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’æ¸›ã‚‰ã™ãŸã‚ã€ã‚¨ãƒ³ãƒ‰ãƒ¦ãƒ¼ã‚¶ãŒä½¿ã†ã®ã¨åŒã˜å½¢ã§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½¿ã£ã¦ãƒ†ã‚¹ãƒˆãŒè¨˜è¿°ã§ãã‚‹ã‚ˆã†ã«è¨­è¨ˆã•ã‚Œã¦ã„ã‚‹ã€[React Testing Library](https://testing-library.com/react) ã®åˆ©ç”¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚

è©³ç´°ã«ã¤ã„ã¦ã¯ã€[ãƒ†ã‚¹ãƒˆã®ãƒ¬ã‚·ãƒ”é›†](/docs/testing-recipes.html) ã‚’ã”è¦§ãã ã•ã„ã€‚

### [Lint ãƒ«ãƒ¼ãƒ«](https://www.npmjs.com/package/eslint-plugin-react-hooks) ã¯å…·ä½“çš„ã«ä½•ã‚’å¼·åˆ¶ã™ã‚‹ã®ã§ã™ã‹ï¼Ÿ {#what-exactly-do-the-lint-rules-enforce}

æˆ‘ã€…ã¯ [ESLint ãƒ—ãƒ©ã‚°ã‚¤ãƒ³](https://www.npmjs.com/package/eslint-plugin-react-hooks) ã‚’æä¾›ã—ã¦ãŠã‚Šã€ã“ã‚Œã«ã‚ˆã‚Š[ãƒ•ãƒƒã‚¯ã®ãƒ«ãƒ¼ãƒ«](/docs/hooks-rules.html)ã‚’å¼·åˆ¶ã—ã¦ãƒã‚°ã‚’æ¸›ã‚‰ã™ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã®ãƒ«ãƒ¼ãƒ«ã¯ã€`use` ã§å§‹ã¾ã‚Šå¤§æ–‡å­—ãŒç¶šãã‚ˆã†ãªåå‰ã®é–¢æ•°ã¯ã™ã¹ã¦ãƒ•ãƒƒã‚¯ã§ã‚ã‚‹ã¨ä»®å®šã—ã¾ã™ã€‚ã“ã‚Œã¯ä¸å®Œå…¨ãªæ¨æ¸¬æ‰‹æ®µã§ã‚ã‚Šéå‰°æ¤œå‡ºãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã“ã¨ã¯èªè­˜ã—ã¦ã„ã¾ã™ãŒã€ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã§ã®è¦ç´„ãªãã—ã¦ã¯ãƒ•ãƒƒã‚¯ã¯ã†ã¾ãå‹•ä½œã—ã¾ã›ã‚“ã€‚ã¾ãŸåå‰ã‚’é•·ãã™ã‚‹ã¨ãƒ•ãƒƒã‚¯ã‚’åˆ©ç”¨ã—ãŸã‚Šè¦ç´„ã‚’å®ˆã£ãŸã‚Šã—ã¦ãã‚Œãªããªã‚‹ã§ã—ã‚‡ã†ã€‚

å…·ä½“çš„ã«ã¯ã€ã“ã®ãƒ«ãƒ¼ãƒ«ã¯ä»¥ä¸‹ã‚’å¼·åˆ¶ã—ã¾ã™ï¼š

* ãƒ•ãƒƒã‚¯ã®å‘¼ã³å‡ºã—ãŒ `PascalCase` åã®é–¢æ•°å†…ï¼ˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨è¦‹ãªã•ã‚Œã¾ã™ï¼‰ã‹ã€ã‚ã‚‹ã„ã¯ä»–ã® `useSomething` å¼ã®åå‰ã®é–¢æ•°å†…ï¼ˆã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã¨è¦‹ãªã•ã‚Œã¾ã™ï¼‰ã«ã‚ã‚‹ã“ã¨ã€‚
* ã™ã¹ã¦ã®ãƒ¬ãƒ³ãƒ€ãƒ¼é–“ã§ãƒ•ãƒƒã‚¯ãŒåŒã˜é †ç•ªã§å‘¼ã³å‡ºã•ã‚Œã‚‹ã“ã¨ã€‚

ã“ã‚Œä»¥å¤–ã«ã‚‚å¹¾ã¤ã‹ã®æ¨æ¸¬ã‚’è¡Œã£ã¦ãŠã‚Šã€ã¾ãŸã€ãƒã‚°æ¤œå‡ºã¨éå‰°æ¤œå‡ºæŠ‘åˆ¶ã¨ã®ãƒãƒ©ãƒ³ã‚¹ã‚’èª¿æ•´ã—ã¦ã„ããªã‹ã§ã€ã“ã‚Œã‚‰ã¯å°†æ¥çš„ã«å¤‰ã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

## ã‚¯ãƒ©ã‚¹ã‹ã‚‰ãƒ•ãƒƒã‚¯ã¸ {#from-classes-to-hooks}

### å€‹ã€…ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒ¡ã‚½ãƒƒãƒ‰ã¯ãƒ•ãƒƒã‚¯ã¨ã©ã®ã‚ˆã†ã«å¯¾å¿œã™ã‚‹ã®ã§ã™ã‹ï¼Ÿ {#how-do-lifecycle-methods-correspond-to-hooks}

* `constructor`: é–¢æ•°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’å¿…è¦ã¨ã—ã¾ã›ã‚“ã€‚state ã¯ [`useState`](/docs/hooks-reference.html#usestate) ã‚’å‘¼ã³å‡ºã™ã¨ãã«åˆæœŸåŒ–ã—ã¾ã™ã€‚åˆæœŸ state ã®è¨ˆç®—ãŒé«˜ä¾¡ã§ã‚ã‚‹å ´åˆã€`useState` ã«é–¢æ•°ã‚’æ¸¡ã™ã“ã¨ãŒã§ãã¾ã™ã€‚

* `getDerivedStateFromProps`: [ãƒ¬ãƒ³ãƒ€ãƒ¼ä¸­ã«](#how-do-i-implement-getderivedstatefromprops)æ›´æ–°ã‚’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ã—ã¾ã™ã€‚

* `shouldComponentUpdate`: ãƒšãƒ¼ã‚¸[ä¸‹éƒ¨ã®](#how-do-i-implement-shouldcomponentupdate) `React.memo` ã«ã¤ã„ã¦ã®èª¬æ˜ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

* `render`: ã“ã‚Œã¯é–¢æ•°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®æœ¬ä½“ãã®ã‚‚ã®ã§ã™ã€‚

* `componentDidMount`, `componentDidUpdate`, `componentWillUnmount`: ã“ã‚Œã‚‰ã®ã‚ã‚‰ã‚†ã‚‹çµ„ã¿åˆã‚ã›ã¯ [`useEffect` ãƒ•ãƒƒã‚¯](/docs/hooks-reference.html#useeffect) ã§è¡¨ç¾ã§ãã¾ã™ï¼ˆ[ã“ã‚Œ](#can-i-skip-an-effect-on-updates)ã‚„[ã“ã‚Œ](#can-i-run-an-effect-only-on-updates)ã®ã‚ˆã†ãªé »åº¦ã®ä½ã„ã‚±ãƒ¼ã‚¹ã‚‚å«ã‚ï¼‰ã€‚

* `componentDidCatch` ã¨ `getDerivedStateFromError`: ãƒ•ãƒƒã‚¯ã«ã‚ˆã‚‹åŒç­‰ç‰©ã¯ã¾ã å­˜åœ¨ã—ã¦ã„ã¾ã›ã‚“ãŒã€è¿‘æ—¥ä¸­ã«è¿½åŠ ã•ã‚Œã‚‹äºˆå®šã§ã™ã€‚

### ãƒ•ãƒƒã‚¯ã§ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã‚’ã©ã®ã‚ˆã†ã«è¡Œã†ã®ã§ã™ã‹ï¼Ÿ {#how-can-i-do-data-fetching-with-hooks}

ã¾ãšã¯ã“ã¡ã‚‰ã®[å°ã•ãªãƒ‡ãƒ¢](https://codesandbox.io/s/jvvkoo8pq3)ã‚’ã”è¦§ãã ã•ã„ã€‚ãƒ•ãƒƒã‚¯ã‚’ä½¿ã£ã¦ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã‚’ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦è©³ã—ãå­¦ã¶ã«ã¯[ã“ã¡ã‚‰ã®è¨˜äº‹](https://www.robinwieruch.de/react-hooks-fetch-data/)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å¤‰æ•°ã®ã‚ˆã†ãªã‚‚ã®ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ {#is-there-something-like-instance-variables}

ã¯ã„ï¼ [`useRef()`](/docs/hooks-reference.html#useref) ãƒ•ãƒƒã‚¯ã¯ DOM ã¸ã®å‚ç…§ã‚’ä¿æŒã™ã‚‹ãŸã‚ã ã‘ã«ã‚ã‚‹ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚"ref" ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯æ±ç”¨ã®ã‚³ãƒ³ãƒ†ãƒŠã§ã‚ã‚Šã€ãã® `current` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å€¤ã¯å¤‰æ›´å¯èƒ½ã‹ã¤ã©ã®ã‚ˆã†ãªå€¤ã§ã‚‚ä¿æŒã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã®ã§ã€ã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å¤‰æ•°ã¨åŒæ§˜ã«åˆ©ç”¨ã§ãã¾ã™ã€‚

ä¾‹ãˆã° `useEffect` å†…ã‹ã‚‰ "ref" ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ›¸ãæ›ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```js{2,8}
function Timer() {
  const intervalRef = useRef();

  useEffect(() => {
    const id = setInterval(() => {
      // ...
    });
    intervalRef.current = id;
    return () => {
      clearInterval(intervalRef.current);
    };
  });

  // ...
}
```

å˜ã«ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ã‚’ã‚»ãƒƒãƒˆã—ãŸã„ã ã‘ã§ã‚ã‚Œã°ï¼ˆ`id` ã¯ã“ã®å‰¯ä½œç”¨å†…ã§ãƒ­ãƒ¼ã‚«ãƒ«ã§ã‚ˆã„ã®ã§ï¼‰ã“ã® ref ã¯å¿…è¦ãªã„ã¨ã“ã‚ã§ã™ãŒã€ã‚‚ã—ã‚‚ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©å†…ã§ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ã‚’ã‚¯ãƒªã‚¢ã—ãŸã„å ´åˆã«ã¯ä¾¿åˆ©ã§ã™ï¼š

```js{3}
  // ...
  function handleCancelClick() {
    clearInterval(intervalRef.current);
  }
  // ...
```

æ¦‚å¿µçš„ã«ã¯ã€ref ã¯ã‚¯ãƒ©ã‚¹ã«ãŠã‘ã‚‹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å¤‰æ•°ã¨ä¼¼ãŸã‚‚ã®ã ã¨è€ƒãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚[é…å»¶åˆæœŸåŒ–](#how-to-create-expensive-objects-lazily)ã‚’ã—ãŸã„å ´åˆã‚’é™¤ãã€ãƒ¬ãƒ³ãƒ€ãƒ¼ã®æœ€ä¸­ã« ref ã‚’æ›¸ãæ›ãˆã‚‹ã“ã¨ã¯ã—ãªã„ã§ãã ã•ã„ã€‚ãã®ä»£ã‚ã‚Šã€é€šå¸¸ ref ã¯ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã‚„å‰¯ä½œç”¨å†…ã§ã ã‘æ›¸ãæ›ãˆã‚‹ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚

### state å¤‰æ•°ã¯ 1 ã¤ã«ã™ã¹ãã§ã™ã‹ã€ãŸãã•ã‚“ä½¿ã†ã¹ãã§ã™ã‹ï¼Ÿ {#should-i-use-one-or-many-state-variables}

ã“ã‚Œã¾ã§ã‚¯ãƒ©ã‚¹ã‚’ä½¿ã£ã¦ã„ãŸãªã‚‰ã€`useState()` ã‚’ 1 å›ã ã‘å‘¼ã‚“ã§ã€1 ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå†…ã«ã™ã¹ã¦ã® state ã‚’å…¥ã‚ŒãŸããªã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ãã†ã—ãŸã‘ã‚Œã°ãã®ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚ä»¥ä¸‹ã¯ãƒã‚¦ã‚¹ã®å‹•ä½œã‚’è¿½è·¡ã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä¾‹ã§ã™ã€‚ä½ç½®ã‚„ã‚µã‚¤ã‚ºã®æƒ…å ±ã‚’ 1 ã¤ã®ãƒ­ãƒ¼ã‚«ãƒ« state ã«ä¿æŒã—ã¦ã„ã¾ã™ã€‚

```js
function Box() {
  const [state, setState] = useState({ left: 0, top: 0, width: 100, height: 100 });
  // ...
}
```

ã“ã“ã§ä¾‹ãˆã°ã€ãƒ¦ãƒ¼ã‚¶ãŒãƒã‚¦ã‚¹ã‚’å‹•ã‹ã—ãŸã¨ãã« `left` ã¨ `top` ã‚’å¤‰æ›´ã—ãŸã„ã¨ã—ã¾ã—ã‚‡ã†ã€‚ã“ã®éš›ã€ã“ã‚Œã‚‰ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å¤ã„ state ã«æ‰‹å‹•ã§ãƒãƒ¼ã‚¸ã—ãªã„ã¨ã„ã‘ãªã„ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ï¼š

```js{4,5}
  // ...
  useEffect(() => {
    function handleWindowMouseMove(e) {
      // Spreading "...state" ensures we don't "lose" width and height
      setState(state => ({ ...state, left: e.pageX, top: e.pageY }));
    }
    // Note: this implementation is a bit simplified
    window.addEventListener('mousemove', handleWindowMouseMove);
    return () => window.removeEventListener('mousemove', handleWindowMouseMove);
  }, []);
  // ...
```

ã“ã‚Œã¯ state å¤‰æ•°ã‚’æ›´æ–°ã™ã‚‹æ™‚ã«ã¯å¤‰æ•°ã®å€¤ãŒ*ç½®æ›*ã•ã‚Œã‚‹ã‹ã‚‰ã§ã™ã€‚ã“ã‚Œã¯æ›´æ–°ã•ã‚Œã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«*ãƒãƒ¼ã‚¸*ã•ã‚Œã‚‹ã¨ã„ã†ã‚¯ãƒ©ã‚¹ã§ã® `this.setState` ã®æŒ™å‹•ã¨ã¯ç•°ãªã‚Šã¾ã™ã€‚

è‡ªå‹•ãƒãƒ¼ã‚¸ãŒãªã„ã¨ã¤ã‚‰ã„å ´åˆã¯ã€`useLegacyState` ã®ã‚ˆã†ãªã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã‚’æ›¸ã„ã¦ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå‹ã® state ã®æ›´æ–°ã‚’ãƒãƒ¼ã‚¸ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã™ã€‚ã—ã‹ã—ã€æˆ‘ã€…ã¯**ã©ã®å€¤ãŒä¸€ç·’ã«æ›´æ–°ã•ã‚Œã‚„ã™ã„ã®ã‹ã«åŸºã¥ã„ã¦ã€state ã‚’è¤‡æ•°ã® state å¤‰æ•°ã«åˆ†å‰²ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚**

ä¾‹ãˆã°ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã® state ã‚’ `position` ã¨ `size` ã¨ã„ã†è¤‡æ•°ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«åˆ†å‰²ã—ã¦ã€ãƒãƒ¼ã‚¸ã‚’è¡Œã‚ãªãã¦ã‚‚ `position` ã‚’å¸¸ã«æ–°ãŸãªå€¤ã§ç½®æ›ã™ã‚‹ã‚ˆã†ã«ã§ãã‚‹ã§ã—ã‚‡ã†ã€‚

```js{2,7}
function Box() {
  const [position, setPosition] = useState({ left: 0, top: 0 });
  const [size, setSize] = useState({ width: 100, height: 100 });

  useEffect(() => {
    function handleWindowMouseMove(e) {
      setPosition({ left: e.pageX, top: e.pageY });
    }
    // ...
```

äº’ã„ã«ç‹¬ç«‹ã—ãŸ state å¤‰æ•°ã‚’åˆ†å‰²ã™ã‚‹ã“ã¨ã«ã¯åˆ¥ã®åˆ©ç‚¹ã‚‚ã‚ã‚Šã¾ã™ã€‚ãã†ã™ã‚‹ã“ã¨ã§å¾Œã‹ã‚‰ãã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã«æŠ½å‡ºã—ã‚„ã™ããªã‚‹ã®ã§ã™ã€‚ä¾‹ãˆã°ï¼š

```js{2,7}
function Box() {
  const position = useWindowPosition();
  const [size, setSize] = useState({ width: 100, height: 100 });
  // ...
}

function useWindowPosition() {
  const [position, setPosition] = useState({ left: 0, top: 0 });
  useEffect(() => {
    // ...
  }, []);
  return position;
}
```

`position` ã® state å¤‰æ•°ã«å¯¾ã™ã‚‹ `useState` ã®å‘¼ã³å‡ºã—ã¨ãã‚Œã«é–¢é€£ã™ã‚‹å‰¯ä½œç”¨ã‚’ã€ãã‚Œã‚‰ã®ã‚³ãƒ¼ãƒ‰ã‚’å¤‰ãˆãšã«ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã«ç§»è¡Œã§ããŸã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚ã‚‚ã—ã™ã¹ã¦ã® state ãŒå˜ä¸€ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å…¥ã£ã¦ã„ãŸã‚‰ã€æŠ½å‡ºã™ã‚‹ã®ã¯ã‚‚ã£ã¨å›°é›£ã ã£ãŸã§ã—ã‚‡ã†ã€‚

ã™ã¹ã¦ã® state ã‚’ 1 ã¤ã® `useState` å‘¼ã³å‡ºã—ã«å«ã‚ã¦ã‚‚å‹•ä½œã—ã¾ã™ã—ã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã”ã¨ã«åˆ¥ã« `useState` ã‚’æŒãŸã›ã‚‹ã“ã¨ã§ã‚‚å‹•ä½œã¯ã—ã¾ã™ã€‚ã—ã‹ã—ã“ã‚Œã‚‰ã®ä¸¡æ¥µç«¯ã®é–“ã§ã†ã¾ããƒãƒ©ãƒ³ã‚¹ã‚’å–ã‚Šã€å°‘æ•°ã®ç‹¬ç«‹ã—ãŸ state å¤‰æ•°ã«é–¢é€£ã™ã‚‹ state ã‚’ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã™ã‚‹ã“ã¨ã§ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯æœ€ã‚‚èª­ã¿ã‚„ã™ããªã‚Šã¾ã™ã€‚state ã®ãƒ­ã‚¸ãƒƒã‚¯ãŒè¤‡é›‘ã«ãªã£ãŸå ´åˆã¯ã€ãã‚Œã‚’[ãƒªãƒ‡ãƒ¥ãƒ¼ã‚µã§ç®¡ç†ã™ã‚‹](/docs/hooks-reference.html#usereducer)ã‹ã€ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã‚’æ›¸ãã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚

### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®æ›´æ–°ã®ã¨ãã ã‘å‰¯ä½œç”¨ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã¯å¯èƒ½ã§ã™ã‹ï¼Ÿ {#can-i-run-an-effect-only-on-updates}

ã“ã‚Œã¯ç¨€ãªãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã§ã™ã€‚å¿…è¦ã§ã‚ã‚Œã°ã€[å¤‰æ›´å¯èƒ½ãª ref](#is-there-something-like-instance-variables) ã‚’ä½¿ã£ã¦ã€åˆå›ãƒ¬ãƒ³ãƒ€ãƒ¼ä¸­ãªã®ã‹æ›´æ–°ä¸­ãªã®ã‹ã«å¯¾å¿œã™ã‚‹çœŸå½å€¤ã‚’æ‰‹å‹•ã§ä¿æŒã—ã€å‰¯ä½œç”¨å†…ã§ãã®å€¤ã‚’å‚ç…§ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ï¼ˆã“ã®ã‚ˆã†ãªã“ã¨ã‚’ä½•åº¦ã‚‚ã‚„ã‚‹å ´åˆã¯ã€ãã®ãŸã‚ã®ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã‚’æ›¸ãã“ã¨ãŒã§ãã¾ã™ï¼‰

### å‰å›ã® props ã‚„ state ã¯ã©ã†ã™ã‚Œã°å–å¾—ã§ãã¾ã™ã‹ï¼Ÿ {#how-to-get-the-previous-props-or-state}

ç¾æ™‚ç‚¹ã§ã¯ã€ã“ã‚Œã¯ [ref ã‚’ä½¿ã£ã¦](#is-there-something-like-instance-variables)æ‰‹å‹•ã§è¡Œã†ã“ã¨ãŒã§ãã¾ã™ï¼š

```js{6,8}
function Counter() {
  const [count, setCount] = useState(0);

  const prevCountRef = useRef();
  useEffect(() => {
    prevCountRef.current = count;
  });
  const prevCount = prevCountRef.current;

  return <h1>Now: {count}, before: {prevCount}</h1>;
}
```

ä¸Šè¨˜ã¯ã¡ã‚‡ã£ã¨è¤‡é›‘ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ã“ã‚Œã‚’ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã«æŠ½å‡ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```js{3,7}
function Counter() {
  const [count, setCount] = useState(0);
  const prevCount = usePrevious(count);
  return <h1>Now: {count}, before: {prevCount}</h1>;
}

function usePrevious(value) {
  const ref = useRef();
  useEffect(() => {
    ref.current = value;
  });
  return ref.current;
}
```

ã“ã‚Œã¯ props ã§ã‚‚ state ã§ã‚‚ã€ãã®ä»–è¨ˆç®—ã•ã‚ŒãŸã©ã®ã‚ˆã†ãªå€¤ã«å¯¾ã—ã¦ã‚‚å‹•ä½œã—ã¾ã™ã€‚

```js{5}
function Counter() {
  const [count, setCount] = useState(0);

  const calculation = count + 100;
  const prevCalculation = usePrevious(calculation);
  // ...
```

ã“ã‚Œã¯æ¯”è¼ƒçš„ã‚ˆãã‚ã‚‹ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã§ã™ã®ã§ã€å°†æ¥çš„ã« `usePrevious` ã¨ã„ã†ãƒ•ãƒƒã‚¯ã‚’ React ãŒæœ€åˆã‹ã‚‰æä¾›ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

[æ´¾ç”Ÿ state ã«ãŠã‘ã‚‹æ¨å¥¨ã•ã‚Œã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³](#how-do-i-implement-getderivedstatefromprops)ã«ã¤ã„ã¦ã‚‚å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### é–¢æ•°å†…ã§å¤ã„ props ã‚„ state ãŒè¦‹ãˆã¦ã„ã‚‹ã®ã¯ãªãœã§ã™ã‹ï¼Ÿ {#why-am-i-seeing-stale-props-or-state-inside-my-function}

ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã«ã›ã‚ˆå‰¯ä½œç”¨é–¢æ•°ã«ã›ã‚ˆã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã«æ›¸ã‹ã‚ŒãŸé–¢æ•°ã‹ã‚‰ã¯ã€ãã®é–¢æ•°ãŒä½œæˆã•ã‚ŒãŸæ™‚ã® props ã‚„ state ãŒã€Œè¦‹ãˆã€ã¾ã™ã€‚ä»¥ä¸‹ã®ã‚ˆã†ãªä¾‹ã‚’è€ƒãˆã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```js
function Example() {
  const [count, setCount] = useState(0);

  function handleAlertClick() {
    setTimeout(() => {
      alert('You clicked on: ' + count);
    }, 3000);
  }

  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>
        Click me
      </button>
      <button onClick={handleAlertClick}>
        Show alert
      </button>
    </div>
  );
}
```

æœ€åˆã« "Show alert" ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€æ¬¡ã«ã‚«ã‚¦ãƒ³ã‚¿ã‚’å¢—åŠ ã•ã›ãŸå ´åˆã€ã‚¢ãƒ©ãƒ¼ãƒˆãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã«è¡¨ç¤ºã•ã‚Œã‚‹ã®ã¯ **"Show alert" ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸæ™‚ç‚¹ã§ã®** `count` å¤‰æ•°ã®å€¤ã«ãªã‚Šã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Š props ã‚„ state ãŒå¤‰ã‚ã‚‰ãªã„ã“ã¨ã‚’å‰æã¨ã—ã¦æ›¸ã‹ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã«ã‚ˆã‚‹ãƒã‚°ãŒé˜²æ­¢ã§ãã¾ã™ã€‚

éåŒæœŸçš„ã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å†…ã§ã€æ„å›³çš„ã« state ã®*æœ€æ–°*ã®å€¤ã‚’èª­ã¿å‡ºã—ãŸã„ã¨ã„ã†å ´åˆã¯ã€ãã®å€¤ã‚’ [ref](/docs/hooks-faq.html#is-there-something-like-instance-variables) å†…ã«ä¿æŒã—ã¦ã€ãã‚Œã‚’æ›¸ãæ›ãˆãŸã‚Šèª­ã¿å‡ºã—ãŸã‚Šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

æœ€å¾Œã«ã€å¤ã„ props ã‚„ state ãŒè¦‹ãˆã¦ã„ã‚‹å ´åˆã«è€ƒãˆã‚‰ã‚Œã‚‹ä»–ã®ç†ç”±ã¯ã€ã€Œä¾å­˜ã®é…åˆ—ã€ã«ã‚ˆã‚‹æœ€é©åŒ–ã‚’ä½¿ã£ãŸéš›ã«æ­£ã—ãä¾å­˜ã™ã‚‹å€¤ã®å…¨éƒ¨ã‚’æŒ‡å®šã—ãªã‹ã£ãŸã€ã¨ã„ã†ã‚‚ã®ã§ã™ã€‚ä¾‹ãˆã°å‰¯ä½œç”¨ãƒ•ãƒƒã‚¯ã®ç¬¬ 2 å¼•æ•°ã« `[]` ã‚’æŒ‡å®šã—ãŸã«ã‚‚é–¢ã‚ã‚‰ãšå‰¯ä½œç”¨å†…ã§ `someProps` ã‚’èª­ã¿å‡ºã—ã¦ã„ã‚‹ã¨ã„ã†å ´åˆã€å‰¯ä½œç”¨é–¢æ•°å†…ã§ã¯ `someProps` ã®åˆæœŸå€¤ãŒãšã£ã¨è¦‹ãˆç¶šã‘ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚è§£æ±ºæ–¹æ³•ã¯ä¾å­˜é…åˆ—è‡ªä½“ã‚’å‰Šé™¤ã™ã‚‹ã‹ã€é…åˆ—ã®ä¸­èº«ã‚’ä¿®æ­£ã™ã‚‹ã“ã¨ã§ã™ã€‚[é–¢æ•°ã®æ‰±ã„æ–¹](#is-it-safe-to-omit-functions-from-the-list-of-dependencies)ã€ãŠã‚ˆã³ä¾å­˜ã™ã‚‹å€¤ã®å¤‰åŒ–ã‚’èª¤ã£ã¦ç„¡è¦–ã™ã‚‹ã“ã¨ãªãå‰¯ä½œç”¨ã®å®Ÿè¡Œå›æ•°ã‚’æ¸›ã‚‰ã™ãŸã‚ã®[ã‚ˆãã‚ã‚‹æ‰‹æ³•](#what-can-i-do-if-my-effect-dependencies-change-too-often)ã«ã¤ã„ã¦ã‚‚ã”è¦§ãã ã•ã„ã€‚

>è£œè¶³
>
> [`exhaustive-deps`](https://github.com/facebook/react/issues/14920) ã¨ã„ã† ESLint ã®ãƒ«ãƒ¼ãƒ«ã‚’ [`eslint-plugin-react-hooks`](https://www.npmjs.com/package/eslint-plugin-react-hooks#installation) ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ä¸€éƒ¨ã¨ã—ã¦æä¾›ã—ã¦ã„ã¾ã™ã€‚ä¾å­˜é…åˆ—ãŒæ­£ã—ãæŒ‡å®šã•ã‚Œã¦ã„ãªã„å ´åˆã«è­¦å‘Šã—ã€ä¿®æ­£ã‚’ææ¡ˆã—ã¾ã™ã€‚

### ã©ã†ã™ã‚Œã° `getDerivedStateFromProps` ã‚’å®Ÿè£…ã§ãã¾ã™ã‹ï¼Ÿ {#how-do-i-implement-getderivedstatefromprops}

ãŠãã‚‰ããã®ã‚ˆã†ãªã‚‚ã®ã¯[å¿…è¦ãªã„](/blog/2018/06/07/you-probably-dont-need-derived-state.html)ã®ã§ã™ãŒã€ã“ã‚ŒãŒæœ¬å½“ã«å¿…è¦ã«ãªã‚‹ç¨€ãªã‚±ãƒ¼ã‚¹ã§ã¯ï¼ˆä¾‹ãˆã° `<Transition>` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å®Ÿè£…ã™ã‚‹ã¨ããªã©ï¼‰ã€ãƒ¬ãƒ³ãƒ€ãƒ¼ã®æœ€ä¸­ã« state ã‚’æ›´æ–°ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚React ã¯æœ€åˆã®ãƒ¬ãƒ³ãƒ€ãƒ¼ã®çµ‚äº†ç›´å¾Œã«æ›´æ–°ã•ã‚ŒãŸ state ã‚’ä½¿ã£ã¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å†å®Ÿè¡Œã—ã¾ã™ã®ã§ã€è¨ˆç®—é‡ã¯é«˜ããªã‚Šã¾ã›ã‚“ã€‚

ä»¥ä¸‹ã®ä¾‹ã§ã¯ã€`row` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å‰å›ã®å€¤ã‚’ state å¤‰æ•°ã«æ ¼ç´ã—å¾Œã§æ¯”è¼ƒã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ï¼š

```js
function ScrollView({row}) {
  const [isScrollingDown, setIsScrollingDown] = useState(false);
  const [prevRow, setPrevRow] = useState(null);

  if (row !== prevRow) {
    // Row changed since last render. Update isScrollingDown.
    setIsScrollingDown(prevRow !== null && row > prevRow);
    setPrevRow(row);
  }

  return `Scrolling down: ${isScrollingDown}`;
}
```

ã“ã‚Œã¯æœ€åˆã¯å¥‡å¦™ã«è¦‹ãˆã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ã“ã‚Œã¾ã§ã‚‚æ¦‚å¿µçš„ã«ã¯ `getDerivedStateFromProps` ã¯ãƒ¬ãƒ³ãƒ€ãƒ¼ä¸­ã«æ›´æ–°ã‚’è¡Œã†ã¨ã„ã†ã®ãŒã¾ã•ã«ç›®çš„ã§ã—ãŸã€‚

### forceUpdate ã®ã‚ˆã†ãªã‚‚ã®ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ {#is-there-something-like-forceupdate}

`useState` ãƒ•ãƒƒã‚¯ã¨ `useReducer` ãƒ•ãƒƒã‚¯ã®ã„ãšã‚Œã‚‚ã€å‰å›ã¨ä»Šå›ã§å€¤ãŒåŒã˜ã§ã‚ã‚‹å ´åˆã¯[æ›´æ–°ã‚’å›é¿](/docs/hooks-reference.html#bailing-out-of-a-state-update)ã—ã¾ã™ã€‚é©å½“ãªå ´æ‰€ã§ state ã‚’å¤‰åŒ–ã•ã›ãŸå¾Œã« `setState` ã‚’å‘¼ã³å‡ºã—ã¦ã‚‚å†ãƒ¬ãƒ³ãƒ€ãƒ¼ã¯ç™ºç”Ÿã—ã¾ã›ã‚“ã€‚

é€šå¸¸ã€React ã§ãƒ­ãƒ¼ã‚«ãƒ« state ã‚’ç›´æ¥å¤‰æ›´ã™ã¹ãã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã—ã‹ã—é¿é›£ãƒãƒƒãƒã¨ã—ã¦ã€ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚’ä½¿ã£ã¦ state ãŒå¤‰åŒ–ã—ã¦ã„ãªã„å ´åˆã§ã‚‚å†ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’å¼·åˆ¶ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

```js
  const [ignored, forceUpdate] = useReducer(x => x + 1, 0);

  function handleClick() {
    forceUpdate();
  }
```

å¯èƒ½ã§ã‚ã‚Œã°ã“ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯é¿ã‘ã‚‹ã‚ˆã†ã«ã—ã¦ãã ã•ã„ã€‚

### é–¢æ•°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¸ã® ref ã‚’ä½œã‚‹ã“ã¨ã¯å¯èƒ½ã§ã™ã‹ï¼Ÿ {#can-i-make-a-ref-to-a-function-component}

ã“ã®ã‚ˆã†ãªã“ã¨ã‚’ã™ã‚‹å¿…è¦ã¯ã‚ã¾ã‚Šãªã„ã¯ãšã§ã™ãŒã€å‘½ä»¤å‹ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«å…¬é–‹ã™ã‚‹ãŸã‚ã« [`useImperativeHandle`](/docs/hooks-reference.html#useimperativehandle) ãƒ•ãƒƒã‚¯ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### DOM ãƒãƒ¼ãƒ‰ã®ä½ç½®ã‚„ã‚µã‚¤ã‚ºã®æ¸¬å®šã¯ã©ã®ã‚ˆã†ã«è¡Œã†ã®ã§ã™ã‹ï¼Ÿ {#how-can-i-measure-a-dom-node}

DOM ãƒãƒ¼ãƒ‰ã®ä½ç½®ã‚„ã‚µã‚¤ã‚ºã‚’æ¸¬å®šã™ã‚‹ãŸã‚ã®åŸºæœ¬çš„ãªæ–¹æ³•ã¨ã—ã¦ã€[ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å½¢å¼ã® ref](/docs/refs-and-the-dom.html#callback-refs) ãŒåˆ©ç”¨ã§ãã¾ã™ã€‚React ã¯ ref ãŒç•°ãªã‚‹ãƒãƒ¼ãƒ‰ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ãŸã³ã«ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚ã“ã¡ã‚‰ã®[å°ã•ãªãƒ‡ãƒ¢](https://codesandbox.io/s/l7m0v5x4v9)ã‚’ã”è¦§ãã ã•ã„ã€‚

```js{4-8,12}
function MeasureExample() {
  const [height, setHeight] = useState(0);

  const measuredRef = useCallback(node => {
    if (node !== null) {
      setHeight(node.getBoundingClientRect().height);
    }
  }, []);

  return (
    <>
      <h1 ref={measuredRef}>Hello, world</h1>
      <h2>The above header is {Math.round(height)}px tall</h2>
    </>
  );
}
```

ã“ã®ä¾‹ã§ `useRef` ã‚’ä½¿ã‚ãªã‹ã£ãŸã®ã¯ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå‹ã® ref ã«ã¯ç¾åœ¨å€¤ãŒå¤‰ã‚ã£ãŸæ™‚ã«ãã‚Œã‚’é€šçŸ¥ã™ã‚‹æ©Ÿèƒ½ãŒãªã„ãŸã‚ã§ã™ã€‚ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ ref ã‚’ä½¿ã†ã“ã¨ã§ã€[å­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒæ¸¬å®šã•ã‚ŒãŸãƒãƒ¼ãƒ‰ã‚’ï¼ˆä¾‹ãˆã°ã‚¯ãƒªãƒƒã‚¯ã«å¿œã˜ã¦ï¼‰å¾Œã‹ã‚‰è¡¨ç¤ºã™ã‚‹å ´åˆã§ã‚‚](https://codesandbox.io/s/818zzk8m78)ã€è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å´ã§ãã®å¤‰æ›´ã«ã¤ã„ã¦é€šçŸ¥ã‚’å—ã‘å–ã‚Šã€æ¸¬å®šå€¤ã‚’åæ˜ ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

`useCallback` ã®ä¾å­˜å€¤ã®é…åˆ—ã¨ã—ã¦ `[]` ã‚’æ¸¡ã—ãŸã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚ã“ã‚Œã«ã‚ˆã‚Šæˆ‘ã€…ã® ref ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒå†ãƒ¬ãƒ³ãƒ€ãƒ¼ã”ã¨ã«å¤‰åŒ–ã—ãªã„ã“ã¨ãŒä¿è¨¼ã•ã‚Œã€React ãŒä¸å¿…è¦ã«ãã®é–¢æ•°ã‚’å‘¼ã°ãªã„ã§æ¸ˆã¿ã¾ã™ã€‚

ã“ã®ä¾‹ã§ã¯ã€ãƒ¬ãƒ³ãƒ€ãƒ¼ã•ã‚Œã¦ã„ã‚‹ `<h1>` ã¯ã©ã®å†ãƒ¬ãƒ³ãƒ€ãƒ¼é–“ã§ã‚‚åŒã˜ã‚ˆã†ã«å­˜åœ¨ã™ã‚‹ãŸã‚ã€ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ ref ã¯ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒã‚¦ãƒ³ãƒˆæ™‚ã¨ã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆæ™‚ã«ã®ã¿å‘¼ã³å‡ºã•ã‚Œã¾ã™ã€‚ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒªã‚µã‚¤ã‚ºãŒç™ºç”Ÿã—ãŸéš›ã«æ¯å›é€šçŸ¥ã‚’å—ã‘å–ã‚ŠãŸã„å ´åˆã¯ã€[`ResizeObserver`](https://developer.mozilla.org/en-US/docs/Web/API/ResizeObserver) ã‚„ã€ã“ã‚Œã‚’ä½¿ã£ã¦ä½œæˆã•ã‚Œã¦ã„ã‚‹ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã®ãƒ•ãƒƒã‚¯ã®åˆ©ç”¨ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚

ãŠæœ›ã¿ã§ã‚ã‚Œã°å†åˆ©ç”¨å¯èƒ½ãªãƒ•ãƒƒã‚¯ã¨ã—ã¦[ã“ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’æŠ½å‡º](https://codesandbox.io/s/m5o42082xy)ã§ãã¾ã™ã€‚

```js{2}
function MeasureExample() {
  const [rect, ref] = useClientRect();
  return (
    <>
      <h1 ref={ref}>Hello, world</h1>
      {rect !== null &&
        <h2>The above header is {Math.round(rect.height)}px tall</h2>
      }
    </>
  );
}

function useClientRect() {
  const [rect, setRect] = useState(null);
  const ref = useCallback(node => {
    if (node !== null) {
      setRect(node.getBoundingClientRect());
    }
  }, []);
  return [rect, ref];
}
```

### `const [thing, setThing] = useState()` ã¨ã„ã†ã®ã¯ã©ã†ã„ã†æ„å‘³ã§ã™ã‹ï¼Ÿ {#what-does-const-thing-setthing--usestate-mean}

ã“ã®æ§‹æ–‡ã«é¦´æŸ“ã¿ãŒãªã„å ´åˆã¯ã‚¹ãƒ†ãƒ¼ãƒˆãƒ•ãƒƒã‚¯ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå†…ã®[èª¬æ˜](/docs/hooks-state.html#tip-what-do-square-brackets-mean)ã‚’ã”è¦§ãã ã•ã„ã€‚


## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ– {#performance-optimizations}

### æ›´æ–°æ™‚ã«å‰¯ä½œç”¨ã‚’ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã™ã‹ï¼Ÿ {#can-i-skip-an-effect-on-updates}

ã¯ã„ã€‚[æ¡ä»¶ä»˜ãã§å‰¯ä½œç”¨ã‚’å®Ÿè¡Œã™ã‚‹](/docs/hooks-reference.html#conditionally-firing-an-effect)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚ã“ã‚ŒãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å‹•ä½œã«ãªã£ã¦ã„ãªã„ã®ã¯ã€æ›´æ–°æ™‚ã®å¯¾å¿œã‚’å¿˜ã‚Œã‚‹ã“ã¨ãŒ[ãƒã‚°ã®å…ƒã«ãªã‚‹](/docs/hooks-effect.html#explanation-why-effects-run-on-each-update)ã‹ã‚‰ã§ã™ã€‚

### ä¾å­˜ã®é…åˆ—ã‹ã‚‰é–¢æ•°ã‚’çœç•¥ã—ã¦ã‚‚å¤§ä¸ˆå¤«ã§ã™ã‹ï¼Ÿ {#is-it-safe-to-omit-functions-from-the-list-of-dependencies}

ã„ã„ãˆã€ä¸€èˆ¬çš„ã«ã¯çœç•¥ã§ãã¾ã›ã‚“ã€‚

```js{3,8}
function Example({ someProp }) {
  function doSomething() {
    console.log(someProp);
  }

  useEffect(() => {
    doSomething();
  }, []); // ğŸ”´ This is not safe (it calls `doSomething` which uses `someProp`)
}
```

å‰¯ä½œç”¨é–¢æ•°ã®å¤–å´ã«ã‚ã‚‹é–¢æ•°å†…ã§ã©ã® props ã‚„ state ãŒä½¿ã‚ã‚Œã¦ã„ã‚‹ã®ã‹è¦šãˆã¦ãŠãã®ã¯å¤§å¤‰ã§ã™ã€‚ã§ã™ã®ã§**å‰¯ä½œç”¨é–¢æ•°å†…ã§ä½¿ã‚ã‚Œã‚‹é–¢æ•°ã¯å‰¯ä½œç”¨é–¢æ•°å†…ã§å®£è¨€ã™ã‚‹**ã®ãŒã‚ˆã„ã§ã—ã‚‡ã†ã€‚ãã†ã™ã‚Œã°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚¹ã‚³ãƒ¼ãƒ—å†…ã®ã©ã®å€¤ã«å‰¯ä½œç”¨ãŒä¾å­˜ã—ã¦ã„ã‚‹ã®ã‹ã‚’æŠŠæ¡ã™ã‚‹ã®ã¯å®¹æ˜“ã§ã™ã€‚

```js{4,8}
function Example({ someProp }) {
  useEffect(() => {
    function doSomething() {
      console.log(someProp);
    }

    doSomething();
  }, [someProp]); // âœ… OK (our effect only uses `someProp`)
}
```

ã“ã®ã‚ˆã†ã«ã—ãŸå¾Œã§ã€ã‚„ã¯ã‚Šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚¹ã‚³ãƒ¼ãƒ—å†…ã®ã©ã®å€¤ã‚‚ä½¿ç”¨ã—ã¦ã„ãªã„ã®ã§ã‚ã‚Œã°ã€`[]` ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã¯å®‰å…¨ã§ã™ï¼š

```js{7}
useEffect(() => {
  function doSomething() {
    console.log('hello');
  }

  doSomething();
}, []); // âœ… OK in this example because we don't use *any* values from component scope
```

ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«ã‚ˆã£ã¦ã¯ã€ä»¥ä¸‹ã«è¿°ã¹ã‚‹ã‚ˆã†ãªé¸æŠè‚¢ã‚‚ã‚ã‚Šã¾ã™ã€‚

>è£œè¶³
>
> [`eslint-plugin-react-hooks`](https://www.npmjs.com/package/eslint-plugin-react-hooks#installation) ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ä¸€éƒ¨ã¨ã—ã¦ [`exhaustive-deps`](https://github.com/facebook/react/issues/14920) ã¨ã„ã† ESLint ã®ãƒ«ãƒ¼ãƒ«ã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚æ›´æ–°ã®ä¸€è²«æ€§ãŒä¿ãŸã‚Œã¦ã„ãªã„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è¦‹ã¤ã‘ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚

ã“ã‚ŒãŒãªãœé‡è¦ãªã®ã‹èª¬æ˜ã—ã¾ã™ã€‚

`useEffect`ã€`useMemo`ã€`useCallback` ã‚ã‚‹ã„ã¯ `useImperativeHandle` ã®æœ€å¾Œã®å¼•æ•°ã¨ã—ã¦[ä¾å­˜ã™ã‚‹å€¤ã®ãƒªã‚¹ãƒˆ](/docs/hooks-reference.html#conditionally-firing-an-effect)ã‚’æ¸¡ã™å ´åˆã€å†…éƒ¨ã§ä½¿ã‚ã‚Œ React ã®ãƒ‡ãƒ¼ã‚¿ã®æµã‚Œã«é–¢ã‚ã‚‹å€¤ãŒã€ã™ã¹ã¦å«ã¾ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã™ãªã‚ã¡ props ã‚„ state ãŠã‚ˆã³ãã‚Œã‚‰ã‚ˆã‚Šæ´¾ç”Ÿã™ã‚‹ã‚ã‚‰ã‚†ã‚‹ã‚‚ã®ã§ã™ã€‚

é–¢æ•°ã‚’ä¾å­˜ã®ãƒªã‚¹ãƒˆã‹ã‚‰å®‰å…¨ã«çœç•¥ã§ãã‚‹ã®ã¯ã€ãã®é–¢æ•°ï¼ˆã‚ã‚‹ã„ã¯ãã®é–¢æ•°ã‹ã‚‰å‘¼ã°ã‚Œã‚‹é–¢æ•°ï¼‰ãŒ propsã€state ãªã„ã—ãã‚Œã‚‰ã‹ã‚‰æ´¾ç”Ÿã™ã‚‹å€¤ã®ã„ãšã‚Œã‚‚å«ã‚“ã§ã„ãªã„å ´åˆ**ã®ã¿**ã§ã™ã€‚ä»¥ä¸‹ã®ä¾‹ã«ã¯ãƒã‚°ãŒã‚ã‚Šã¾ã™ã€‚

```js{5,12}
function ProductPage({ productId }) {
  const [product, setProduct] = useState(null);

  async function fetchProduct() {
    const response = await fetch('http://myapi/product' + productId); // Uses productId prop
    const json = await response.json();
    setProduct(json);
  }

  useEffect(() => {
    fetchProduct();
  }, []); // ğŸ”´ Invalid because `fetchProduct` uses `productId`
  // ...
}
```

**æ¨å¥¨ã•ã‚Œã‚‹ä¿®æ­£æ–¹æ³•ã¯ã€ã“ã®é–¢æ•°ã‚’å‰¯ä½œç”¨*å†…*ã«ç§»å‹•ã™ã‚‹ã“ã¨ã§ã™ã€‚**ã“ã‚Œã«ã‚ˆã‚Šã€å‰¯ä½œç”¨ãŒã©ã® props ã‚„ state ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ã®ã‹æŠŠæ¡ã—ã‚„ã™ããªã‚Šã€ãã‚Œã‚‰ãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ä¿è¨¼ã—ã‚„ã™ããªã‚Šã¾ã™ã€‚

```js{5-10,13}
function ProductPage({ productId }) {
  const [product, setProduct] = useState(null);

  useEffect(() => {
    // By moving this function inside the effect, we can clearly see the values it uses.
    async function fetchProduct() {
      const response = await fetch('http://myapi/product' + productId);
      const json = await response.json();
      setProduct(json);
    }

    fetchProduct();
  }, [productId]); // âœ… Valid because our effect only uses productId
  // ...
}
```

ã“ã‚Œã«ã‚ˆã‚Šã€è¦ã‚‰ãªããªã£ãŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«å¯¾ã—ã¦å‰¯ä½œç”¨å†…ã§ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°ã‚’ä½¿ã£ã¦å¯¾å‡¦ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

```js{2,6,10}
  useEffect(() => {
    let ignore = false;
    async function fetchProduct() {
      const response = await fetch('http://myapi/product/' + productId);
      const json = await response.json();
      if (!ignore) setProduct(json);
    }

    fetchProduct();
    return () => { ignore = true };
  }, [productId]);
```

å‰¯ä½œç”¨å†…ã«é–¢æ•°ã‚’ç§»å‹•ã—ãŸã“ã¨ã§ã€ä¾å­˜ãƒªã‚¹ãƒˆå†…ã«ã“ã®é–¢æ•°ã‚’å«ã‚ãªã„ã§ã‚ˆããªã‚Šã¾ã—ãŸã€‚

>ãƒ’ãƒ³ãƒˆ
>
>ãƒ•ãƒƒã‚¯ã§ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦[ã“ã¡ã‚‰ã®å°ã•ãªãƒ‡ãƒ¢](https://codesandbox.io/s/jvvkoo8pq3)ãŠã‚ˆã³[ã“ã¡ã‚‰ã®è¨˜äº‹](https://www.robinwieruch.de/react-hooks-fetch-data/)ã‚’ã”è¦§ãã ã•ã„ã€‚

**ä½•ã‚‰ã‹ã®ç†ç”±ã§å‰¯ä½œç”¨å†…ã«é–¢æ•°ã‚’ç§»å‹•*ã§ããªã„*ã¨ã„ã†å ´åˆã€ä»–ã«ã¨ã‚Šã†ã‚‹é¸æŠè‚¢ãŒã„ãã¤ã‹ã‚ã‚Šã¾ã™ã€‚**

* **ãã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å¤–éƒ¨ã«ãã®é–¢æ•°ã‚’ç§»å‹•ã§ããªã„ã‹è€ƒãˆã¾ã—ã‚‡ã†**ã€‚ãã®å ´åˆã€é–¢æ•°ã¯ props ã‚„ state ã‚’å‚ç…§ã—ã¦ã„ãªã„ã“ã¨ãŒä¿è¨¼ã•ã‚Œã‚‹ã®ã§ã€ä¾å­˜ã®ãƒªã‚¹ãƒˆã«å«ã¾ãšã«æ¸ˆã‚€ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
* ä½¿ãŠã†ã¨ã—ã¦ã„ã‚‹é–¢æ•°ãŒç´”ç²‹ãªè¨ˆç®—ã®ã¿ã‚’è¡Œã„ã€ãƒ¬ãƒ³ãƒ€ãƒ¼ä¸­ã«å‘¼ã‚“ã§æ§‹ã‚ãªã„ã‚‚ã®ã§ã‚ã‚‹ãªã‚‰ã€ãã®é–¢æ•°ã‚’ä»£ã‚ã‚Šã«**å‰¯ä½œç”¨ã®å¤–éƒ¨ã§å‘¼ã¶**ã‚ˆã†ã«ã—ã¦ã€å‰¯ä½œç”¨ä¸­ã§ã¯ãã®è¿”ã‚Šå€¤ã«ä¾å­˜ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚
* æœ€çµ‚æ‰‹æ®µã¨ã—ã¦ã€é–¢æ•°ã‚’ä¾å­˜ãƒªã‚¹ãƒˆã«åŠ ãˆã¤ã¤ã€[`useCallback`](/docs/hooks-reference.html#usecallback) ã‚’ä½¿ã£ã¦**ãã®å®šç¾©ã‚’ãƒ©ãƒƒãƒ—ã™ã‚‹**ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€*é–¢æ•°è‡ªä½“*ã®ä¾å­˜ãŒå¤‰ã‚ã‚‰ãªã„é™ã‚Šé–¢æ•°ã‚‚å¤‰åŒ–ã—ãªã„ã“ã¨ã‚’ä¿è¨¼ã§ãã¾ã™ã€‚

```js{2-5}
function ProductPage({ productId }) {
  // âœ… Wrap with useCallback to avoid change on every render
  const fetchProduct = useCallback(() => {
    // ... Does something with productId ...
  }, [productId]); // âœ… All useCallback dependencies are specified

  return <ProductDetails fetchProduct={fetchProduct} />;
}

function ProductDetails({ fetchProduct }) {
  useEffect(() => {
    fetchProduct();
  }, [fetchProduct]); // âœ… All useEffect dependencies are specified
  // ...
}
```

ä¸Šè¨˜ã®ä¾‹ã§ã¯é–¢æ•°ã‚’ä¾å­˜ãƒªã‚¹ãƒˆã«å«ã‚ã‚‹**å¿…è¦ãŒã‚ã‚‹**ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚ã“ã‚Œã«ã‚ˆã‚Š `ProductPage` ã® `productId` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå¤‰åŒ–ã—ãŸå ´åˆã«è‡ªå‹•çš„ã« `ProductDetail` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã§ãƒ‡ãƒ¼ã‚¿ã®å†å–å¾—ãŒç™ºç”Ÿã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

### å‰¯ä½œç”¨ã®ä¾å­˜ãƒªã‚¹ãƒˆãŒé »ç¹ã«å¤‰ã‚ã‚Šã™ãã‚‹å ´åˆã¯ã©ã†ã™ã‚Œã°ã‚ˆã„ã§ã™ã‹ï¼Ÿ {#what-can-i-do-if-my-effect-dependencies-change-too-often}

ã—ã°ã—ã°ã€ã‚ã‚‹å‰¯ä½œç”¨ãŒã¨ã¦ã‚‚é »ç¹ã«å¤‰åŒ–ã™ã‚‹ state ã‚’åˆ©ç”¨ã—ãªã„ã¨ã„ã‘ãªã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚ä¾å­˜ã®ãƒªã‚¹ãƒˆã‹ã‚‰ãã® state ã‚’çœç•¥ã—ãŸããªã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€é€šå¸¸ãã‚Œã¯ãƒã‚°ã«ãªã‚Šã¾ã™ã€‚

```js{6,9}
function Counter() {
  const [count, setCount] = useState(0);

  useEffect(() => {
    const id = setInterval(() => {
      setCount(count + 1); // This effect depends on the `count` state
    }, 1000);
    return () => clearInterval(id);
  }, []); // ğŸ”´ Bug: `count` is not specified as a dependency

  return <h1>{count}</h1>;
}
```

ä¾å­˜ã®ãƒªã‚¹ãƒˆãŒç©ºã§ã‚ã‚‹ã¨ã„ã†ã“ã¨ (`[]`) ã¯ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒã‚¦ãƒ³ãƒˆæ™‚ã«å‰¯ä½œç”¨ãŒä¸€åº¦ã®ã¿å®Ÿè¡Œã•ã‚Œã€æ¯å›ã®å†ãƒ¬ãƒ³ãƒ€ãƒ¼æ™‚ã«ã¯å®Ÿè¡Œã•ã‚Œãªã„ã¨ã„ã†ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚ã“ã“ã§ã®å•é¡Œã¯ã€å‰¯ä½œç”¨ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒå®Ÿè¡Œã•ã‚ŒãŸæ™‚ç‚¹ã§ `count` ã®å€¤ãŒ `0` ã«è¨­å®šã•ã‚ŒãŸã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ã‚’ä½œæˆã—ãŸãŸã‚ã€`setInterval` å†…ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§ `count` ã®å€¤ãŒå¤‰ã‚ã‚‰ãªããªã£ã¦ã—ã¾ã†ã€ã¨ã„ã†ã“ã¨ã§ã™ã€‚æ¯ç§’ã”ã¨ã«ã“ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¯ `setCount(0 + 1)` ã‚’å‘¼ã³å‡ºã™ã®ã§ã€ã‚«ã‚¦ãƒ³ãƒˆã¯ 1 ã®ã¾ã¾å¤‰ã‚ã‚‰ãªããªã£ã¦ã—ã¾ã„ã¾ã™ã€‚

ä¾å­˜ã®ãƒªã‚¹ãƒˆã¨ã—ã¦ `[count]` ã‚’æŒ‡å®šã™ã‚Œã°ãƒã‚°ã¯èµ·ããªããªã‚Šã¾ã™ãŒã€ãã®å ´åˆå€¤ãŒå¤‰åŒ–ã™ã‚‹ãŸã³ã«ã‚¿ã‚¤ãƒãƒ¼ãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚äº‹å®Ÿä¸Šãã‚Œãã‚Œã® `setInterval` ã¯ä¸€åº¦ã—ã‹å®Ÿè¡Œã•ã‚Œãšã«ï¼ˆ`setTimeout` ã®ã‚ˆã†ã«ï¼‰ã‚¯ãƒªã‚¢ã•ã‚Œã¦ã—ã¾ã†ã®ã§ã™ã€‚ã“ã‚Œã¯æœ›ã¾ã—ã„å‹•ä½œã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã‚Œã‚’ä¿®æ­£ã™ã‚‹ãŸã‚ã€[`setState` é–¢æ•°å½¢å¼ã«ã‚ˆã‚‹æ›´æ–°](/docs/hooks-reference.html#functional-updates)ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Š state ã®*ç¾åœ¨å€¤*ã‚’å‚ç…§ã›ãšã« state ãŒ*ã©ã®ã‚ˆã†ã«*æ›´æ–°ã•ã‚Œã‚‹ã¹ãã‹ã‚’æŒ‡å®šã§ãã¾ã™ã€‚

```js{6,9}
function Counter() {
  const [count, setCount] = useState(0);

  useEffect(() => {
    const id = setInterval(() => {
      setCount(c => c + 1); // âœ… This doesn't depend on `count` variable outside
    }, 1000);
    return () => clearInterval(id);
  }, []); // âœ… Our effect doesn't use any variables in the component scope

  return <h1>{count}</h1>;
}
```

ï¼ˆ`setCount` é–¢æ•°ã«ã¤ã„ã¦ã¯åŒä¸€æ€§ãŒä¿ãŸã‚Œã‚‹ã“ã¨ãŒä¿è¨¼ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€çœç•¥ã—ã¦æ§‹ã„ã¾ã›ã‚“ï¼‰

ã“ã‚Œã§ã€`setInterval` ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¯ 1 ç§’ã« 1 å›å®Ÿè¡Œã•ã‚Œã¾ã™ãŒã€å†…éƒ¨ã® `setCount` ã¯ `count` ã®æœ€æ–°ã®å€¤ï¼ˆã“ã®ä¾‹ã§ã¯ `c`ï¼‰ã‚’å‚ç…§ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

ã‚ˆã‚Šè¤‡é›‘ãªã‚±ãƒ¼ã‚¹ï¼ˆã‚ã‚‹ state ãŒåˆ¥ã® state ã«ä¾å­˜ã—ã¦ã„ã‚‹å ´åˆãªã©ï¼‰ã«ãŠã„ã¦ã¯ã€state æ›´æ–°ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ [`useReducer` ãƒ•ãƒƒã‚¯](/docs/hooks-reference.html#usereducer)ã‚’ä½¿ã£ã¦å‰¯ä½œç”¨ã®å¤–éƒ¨ã«ç§»å‹•ã™ã‚‹ã“ã¨ã‚’è€ƒæ…®ã—ã¦ãã ã•ã„ã€‚[ã“ã¡ã‚‰ã®è¨˜äº‹](https://adamrackis.dev/state-and-use-reducer/)ã«ã“ã®ã‚„ã‚Šæ–¹ã«ã¤ã„ã¦ã®ä¾‹ãŒã‚ã‚Šã¾ã™ã€‚**`useReducer` ã‹ã‚‰è¿”ã•ã‚Œã‚‹ `dispatch` é–¢æ•°ã¯å¸¸ã«åŒä¸€æ€§ãŒä¿ãŸã‚Œã¾ã™**ã€‚ã“ã‚Œã¯ãƒªãƒ‡ãƒ¥ãƒ¼ã‚µ (reducer) é–¢æ•°ãŒã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã§å®£è¨€ã•ã‚Œã¦ãŠã‚Š props ã‚’èª­ã¿å‡ºã—ã¦ã„ã‚‹å ´åˆã§ã‚‚åŒæ§˜ã§ã™ã€‚

æœ€çµ‚æ‰‹æ®µã¨ã—ã¦ã€ã‚¯ãƒ©ã‚¹ã«ãŠã‘ã‚‹ `this` ã®ã‚ˆã†ãªã‚‚ã®ãŒæ¬²ã—ã„å ´åˆã¯ã€[ref](/docs/hooks-faq.html#is-there-something-like-instance-variables) ã‚’ä½¿ã£ã¦ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ãªå€¤ã‚’ä¿æŒã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãã†ã™ã‚Œã°ãã®å€¤ã‚’èª­ã¿æ›¸ãå¯èƒ½ã§ã™ã€‚ä¾‹ãˆã°ï¼š

```js{2-6,10-11,16}
function Example(props) {
  // Keep latest props in a ref.
  const latestProps = useRef(props);
  useEffect(() => {
    latestProps.current = props;
  });

  useEffect(() => {
    function tick() {
      // Read latest props at any time
      console.log(latestProps.current);
    }

    const id = setInterval(tick, 1000);
    return () => clearInterval(id);
  }, []); // This effect never re-runs
}
```

ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ãªå€¤ã«ä¾å­˜ã™ã‚‹ã“ã¨ã§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®æŒ™å‹•ãŒäºˆæ¸¬ã—ã¥ã‚‰ããªã‚‹ãŸã‚ã€ã“ã‚Œã¯ä»£æ›¿æ‰‹æ®µãŒæ€ã„ã¤ã‹ãªã„å ´åˆã«ã®ã¿åˆ©ç”¨ã—ã¦ãã ã•ã„ã€‚ã†ã¾ããƒ•ãƒƒã‚¯ã«ç§»è¡Œã§ããªã„ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒã‚ã£ãŸå ´åˆã¯å‹•ä½œã™ã‚‹ã‚³ãƒ¼ãƒ‰ä¾‹ã‚’æ·»ãˆã¦ [issue ã‚’ä½œæˆ](https://github.com/facebook/react/issues/new)ã—ã¦ã„ãŸã ã‘ã‚Œã°ãŠæ‰‹ä¼ã„ã—ã¾ã™ã€‚

### ã©ã†ã™ã‚Œã° `shouldComponentUpdate` ã‚’å®Ÿè£…ã§ãã¾ã™ã‹ï¼Ÿ {#how-do-i-implement-shouldcomponentupdate}

é–¢æ•°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ `React.memo` ã§ãƒ©ãƒƒãƒ—ã—ã¦ props ã‚’æµ…ãæ¯”è¼ƒã™ã‚‹ã‚ˆã†ã«ã—ã¦ãã ã•ã„ã€‚

```js
const Button = React.memo((props) => {
  // your component
});
```

ã“ã‚ŒãŒãƒ•ãƒƒã‚¯ã«ãªã£ã¦ã„ãªã„ã®ã¯ã€ãƒ•ãƒƒã‚¯ã¨é•ã£ã¦çµ„ã¿åˆã‚ã›å¯èƒ½ã§ã¯ãªã„ã‹ã‚‰ã§ã™ã€‚`React.memo` ã¯ `PureComponent` ã®åŒç­‰ç‰©ã§ã™ãŒã€props ã®ã¿ã‚’æ¯”è¼ƒã™ã‚‹ã¨ã„ã†é•ã„ãŒã‚ã‚Šã¾ã™ã€‚ï¼ˆæ–°æ—§ã® props ã‚’å—ã‘å–ã‚‹ã‚«ã‚¹ã‚¿ãƒ ã®æ¯”è¼ƒé–¢æ•°ã‚’ 2 ã¤ã‚ã®å¼•æ•°ã¨ã—ã¦åŠ ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãã®é–¢æ•°ãŒ true ã‚’è¿”ã—ãŸå ´åˆã¯ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®æ›´æ–°ã¯ã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã¾ã™ï¼‰

`React.memo` ã¯ state ã‚’æ¯”è¼ƒã—ã¾ã›ã‚“ãŒã€ã“ã‚Œã¯æ¯”è¼ƒå¯èƒ½ãªå˜ä¸€ã® state ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒå­˜åœ¨ã—ãªã„ã‹ã‚‰ã§ã™ã€‚ã—ã‹ã—å­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå´ã‚‚ç´”ç²‹ã«ã—ã¦ãŠãã“ã¨ã‚„ã€[`useMemo` ã‚’ä½¿ã£ã¦å€‹ã€…ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æœ€é©åŒ–ã™ã‚‹](/docs/hooks-faq.html#how-to-memoize-calculations)ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

### è¨ˆç®—çµæœã®ãƒ¡ãƒ¢åŒ–ã¯ã©ã®ã‚ˆã†ã«è¡Œã†ã®ã§ã™ã‹ï¼Ÿ {#how-to-memoize-calculations}

[`useMemo`](/docs/hooks-reference.html#usememo) ãƒ•ãƒƒã‚¯ã‚’ä½¿ã†ã¨ã€å‰ã®è¨ˆç®—çµæœã‚’ã€Œè¨˜æ†¶ã€ã—ã¦ãŠãã“ã¨ã§ã€è¤‡æ•°ã®ãƒ¬ãƒ³ãƒ€ãƒ¼é–“ã§è¨ˆç®—çµæœã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```js
const memoizedValue = useMemo(() => computeExpensiveValue(a, b), [a, b]);
```

ã“ã®ã‚³ãƒ¼ãƒ‰ã¯ `computeExpensiveValue(a, b)` ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚ã—ã‹ã—ä¾å­˜ã§ã‚ã‚‹ `[a, b]` ã®çµ„ã¿åˆã‚ã›ãŒå‰å›ã®å€¤ã¨å¤‰ã‚ã£ã¦ã„ãªã„å ´åˆã¯ã€`useMemo` ã¯ã“ã®é–¢æ•°ã® 2 å›ç›®ã®å‘¼ã³å‡ºã—ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã€å˜ã«å‰å›è¿”ã—ãŸã®ã¨åŒã˜å€¤ã‚’è¿”ã—ã¾ã™ã€‚

`useMemo` ã«æ¸¡ã—ãŸé–¢æ•°ã¯ãƒ¬ãƒ³ãƒ€ãƒ¼ä¸­ã«å®Ÿè¡Œã•ã‚Œã‚‹ã¨ã„ã†ã“ã¨ã‚’è¦šãˆã¦ãŠã„ã¦ãã ã•ã„ã€‚ãƒ¬ãƒ³ãƒ€ãƒ¼ä¸­ã«é€šå¸¸ã‚„ã‚‰ãªã„ã‚ˆã†ãªã“ã¨ã‚’ã‚„ã‚‰ãªã„ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚ä¾‹ãˆã°å‰¯ä½œç”¨ã¯ `useMemo` ã§ã¯ãªã `useEffect` ã®ä»•äº‹ã§ã™ã€‚

**`useMemo` ã¯ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã®ãŸã‚ã«ä½¿ã†ã‚‚ã®ã§ã‚ã‚Šã€æ„å‘³ä¸Šã®ä¿è¨¼ãŒã‚ã‚‹ã‚‚ã®ã ã¨è€ƒãˆãªã„ã§ãã ã•ã„ã€‚**å°†æ¥çš„ã« React ã¯ã€ä¾‹ãˆã°ç”»é¢å¤–ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆç”¨ã®ãƒ¡ãƒ¢ãƒªã‚’è§£æ”¾ã™ã‚‹ã€ãªã©ã®ç†ç”±ã§ã€ãƒ¡ãƒ¢åŒ–ã•ã‚ŒãŸå€¤ã‚’ã€Œå¿˜ã‚Œã‚‹ã€ã‚ˆã†ã«ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚`useMemo` ãªã—ã§ã‚‚å‹•ä½œã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã®ãŸã‚ã« `useMemo` ã‚’åŠ ãˆã‚‹ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚ï¼ˆå€¤ãŒ*çµ¶å¯¾ã«*å†è¨ˆç®—ã•ã‚Œã¦ã¯ã„ã‘ãªã„ã¨ã„ã†ã‚ˆã†ãªç¨€ãªã‚±ãƒ¼ã‚¹ã§ã¯ã€ref ã®[é…å»¶åˆæœŸåŒ–](#how-to-create-expensive-objects-lazily)ã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ï¼‰

ä¾¿åˆ©ãªã“ã¨ã«ã€`useMemo` ã¯å­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®è¨ˆç®—é‡ã®é«˜ã„å†ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹ã®ã«ã‚‚ä½¿ãˆã¾ã™ï¼š

```js
function Parent({ a, b }) {
  // Only re-rendered if `a` changes:
  const child1 = useMemo(() => <Child1 a={a} />, [a]);
  // Only re-rendered if `b` changes:
  const child2 = useMemo(() => <Child2 b={b} />, [b]);
  return (
    <>
      {child1}
      {child2}
    </>
  )
}
```

ãƒ•ãƒƒã‚¯å‘¼ã³å‡ºã—ã¯ãƒ«ãƒ¼ãƒ—å†…ã«[é…ç½®ã§ããªã„](/docs/hooks-rules.html)ãŸã‚ã€ã“ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¯ãƒ«ãƒ¼ãƒ—å†…ã§ã¯å‹•ä½œã—ãªã„ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚ãŸã ã—ãƒªã‚¹ãƒˆã®ã‚¢ã‚¤ãƒ†ãƒ ã®éƒ¨åˆ†ã‚’åˆ¥ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«æŠ½å‡ºã—ã¦ãã®ä¸­ã§ `useMemo` ã‚’å‘¼ã³å‡ºã™ã“ã¨ã¯å¯èƒ½ã§ã™ã€‚

### è¨ˆç®—é‡ã®å¤§ãã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆã‚’é…å»¶ã™ã‚‹æ–¹æ³•ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ {#how-to-create-expensive-objects-lazily}

`useMemo` ã‚’ä½¿ãˆã°åŒã˜å€¤ã«ä¾å­˜ã—ã¦ã„ã‚‹[é«˜ä¾¡ãªè¨ˆç®—ã®çµæœã‚’ãƒ¡ãƒ¢åŒ–](#how-to-memoize-calculations)ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã—ã‹ã—ã“ã‚Œã¯ã‚ãã¾ã§ãƒ’ãƒ³ãƒˆã¨ã—ã¦ä½¿ã‚ã‚Œã‚‹ã‚‚ã®ã§ã‚ã‚Šã€è¨ˆç®—ãŒå†å®Ÿè¡Œã•ã‚Œãªã„ã¨ã„ã†ã“ã¨ã‚’*ä¿è¨¼*ã—ã¾ã›ã‚“ã€‚ã—ã‹ã—æ™‚ã«ã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒä¸€åº¦ã—ã‹ä½œã‚‰ã‚Œãªã„ã“ã¨ã‚’ä¿è¨¼ã—ãŸã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚

**ã¾ãšã‚ˆãã‚ã‚‹ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã¯ state ã®åˆæœŸå€¤ã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒé«˜ä¾¡ãªå ´åˆã§ã™ã€‚**

```js
function Table(props) {
  // âš ï¸ createRows() is called on every render
  const [rows, setRows] = useState(createRows(props.count));
  // ...
}
```

æ¬¡å›ä»¥é™ã®ãƒ¬ãƒ³ãƒ€ãƒ¼ã§ã¯ç„¡è¦–ã•ã‚Œã‚‹åˆæœŸ state ã‚’æ¯å›ä½œæˆã—ãªãŠã™ã“ã¨ã‚’é˜²ããŸã‚ã€`useState` ã«**é–¢æ•°**ã‚’æ¸¡ã™ã“ã¨ãŒã§ãã¾ã™ã€‚

```js
function Table(props) {
  // âœ… createRows() is only called once
  const [rows, setRows] = useState(() => createRows(props.count));
  // ...
}
```

React ã¯åˆå›ãƒ¬ãƒ³ãƒ€ãƒ¼æ™‚ã®ã¿ã“ã®é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚[`useState` ã® API ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹](/docs/hooks-reference.html#usestate)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

ã¾ãŸã€**ã¾ã‚Œã« `useRef()` ã®åˆæœŸå€¤ã‚’æ¯å›å†ä½œæˆã™ã‚‹ã“ã¨ã‚’é¿ã‘ãŸã„ã¨ã„ã†ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚**ä¾‹ãˆã°ã€å‘½ä»¤å‹ã§ä½œæˆã™ã‚‹ã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒä¸€åº¦ã—ã‹ä½œæˆã•ã‚Œãªã„ã“ã¨ã‚’ä¿è¨¼ã—ãŸã„ã¨ã„ã†ã“ã¨ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

```js
function Image(props) {
  // âš ï¸ IntersectionObserver is created on every render
  const ref = useRef(new IntersectionObserver(onIntersect));
  // ...
}
```

`useRef` ã¯ `useState` ã®ã‚ˆã†ãªé–¢æ•°ã‚’æ¸¡ã™å½¢å¼ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰è¨˜æ³•ãŒ**ä½¿ãˆã¾ã›ã‚“**ã€‚ä»£ã‚ã‚Šã«ã€è‡ªåˆ†ã§é–¢æ•°ã‚’æ›¸ã„ã¦é«˜ä¾¡ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’é…å»¶å‹ã§ ref ã«è¨­å®šã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

```js
function Image(props) {
  const ref = useRef(null);

  // âœ… IntersectionObserver is created lazily once
  function getObserver() {
    if (ref.current === null) {
      ref.current = new IntersectionObserver(onIntersect);
    }
    return ref.current;
  }

  // When you need it, call getObserver()
  // ...
}
```

ã“ã‚Œã«ã‚ˆã‚Šã€æœ¬å½“ã«å¿…è¦ã«ãªã‚‹ã¾ã§é«˜ä¾¡ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆã‚’é¿ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚Flow ã‚„ TypeScript ã‚’ä½¿ã£ã¦ã„ã‚‹ãªã‚‰ã€`getObserver()` ã‚’ non-nullable ãªå‹ã«ã—ã¦ãŠãã¨ä¾¿åˆ©ã§ã—ã‚‡ã†ã€‚


### ãƒ¬ãƒ³ãƒ€ãƒ¼å†…ã§é–¢æ•°ã‚’ä½œã‚‹ã›ã„ã§ãƒ•ãƒƒã‚¯ã¯é…ããªã‚‹ã®ã§ã¯ãªã„ã§ã™ã‹ï¼Ÿ {#are-hooks-slow-because-of-creating-functions-in-render}

ã„ã„ãˆã€‚ãƒ¢ãƒ€ãƒ³ãƒ–ãƒ©ã‚¦ã‚¶ã§ã¯ã€ç‰¹æ®Šãªå ´åˆã‚’é™¤ã„ã¦ã€ã‚¯ãƒ©ã‚¹ã¨æ¯”è¼ƒã—ã¦ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ãƒ¼ã®ç”Ÿã®æ€§èƒ½ã¯ãã‚Œã»ã©å¤‰ã‚ã‚Šã¾ã›ã‚“ã€‚

ã—ã‹ã‚‚ã€ãƒ•ãƒƒã‚¯ã®è¨­è¨ˆã¯å¹¾ã¤ã‹ã®ç‚¹ã«ãŠã„ã¦ã¯ã‚ˆã‚ŠåŠ¹ç‡çš„ã§ã™ã€‚

* ãƒ•ãƒƒã‚¯ã‚’ä½¿ãˆã°ã€ã‚¯ãƒ©ã‚¹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ä½œæˆã‚„ã€ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã§ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã®ãƒã‚¤ãƒ³ãƒ‰ã¨ã„ã£ãŸã€ã‚¯ãƒ©ã‚¹ã®å ´åˆã«å¿…è¦ãªæ§˜ã€…ãªã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ã‚’å›é¿ã§ãã¾ã™ã€‚

* ãƒ•ãƒƒã‚¯ã‚’ã†ã¾ãç”¨ã„ãŸã‚³ãƒ¼ãƒ‰ã¯ã€é«˜éšã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚„ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ—ãƒ­ãƒƒãƒ—ã‚„ã‚³ãƒ³ãƒ†ã‚¯ã‚¹ãƒˆã‚’å¤šç”¨ã™ã‚‹ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã§è¦‹ã‚‰ã‚Œã‚‹ã‚ˆã†ãª**æ·±ã„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒã‚¹ãƒˆã‚’å¿…è¦ã¨ã—ã¾ã›ã‚“**ã€‚ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ„ãƒªãƒ¼ãŒå°ã•ã‘ã‚Œã°ã€React ãŒã‚„ã‚‹ã¹ãä»•äº‹ã‚‚æ¸›ã‚Šã¾ã™ã€‚

éå»ã«ã¯ã€ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³é–¢æ•°ã«ã‚ˆã‚‹ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®æ‡¸å¿µã¨ã„ã†ã®ã¯ã€ãƒ¬ãƒ³ãƒ€ãƒ¼æ¯ã«æ–°ã—ã„ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã‚’ä½œã£ã¦æ¸¡ã™ã¨å­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã® `shouldComponentUpdate` ã«ã‚ˆã‚‹æœ€é©åŒ–ãŒå‹•ã‹ãªããªã‚‹ã€ã¨ã„ã†å•é¡Œã¨é–¢é€£ã—ã¦ã„ã¾ã—ãŸã€‚ãƒ•ãƒƒã‚¯ã§ã¯ã“ã®å•é¡Œã«ã¤ã„ã¦ 3 ã¤ã®å´é¢ã‹ã‚‰å¯¾å¿œã—ã¾ã™ã€‚

* [`useCallback`](/docs/hooks-reference.html#usecallback) ãƒ•ãƒƒã‚¯ã‚’ä½¿ãˆã°å†ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’ã¾ãŸã„ã§åŒã˜ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’ä¿æŒã§ãã‚‹ã®ã§ã€`shouldComponentUpdate` ãŒã†ã¾ãå‹•ä½œã—ç¶šã‘ã¾ã™

    ```js{2}
    // Will not change unless `a` or `b` changes
    const memoizedCallback = useCallback(() => {
      doSomething(a, b);
    }, [a, b]);
    ```

* [`useMemo`](/docs/hooks-faq.html#how-to-memoize-calculations) ãƒ•ãƒƒã‚¯ã‚’ä½¿ã†ã“ã¨ã§å€‹ã€…ã®å­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ã„ã¤æ›´æ–°ã™ã‚‹ã®ã‹ã‚’åˆ¶å¾¡ã—ã‚„ã™ããªã‚‹ãŸã‚ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒç´”ç²‹ã§ã‚ã‚‹å¿…è¦æ€§ã¯ä½ããªã£ã¦ã„ã¾ã™

* æœ€å¾Œã«ã€ä»¥ä¸‹ã§èª¬æ˜ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã«ã€[`useReducer`](/docs/hooks-reference.html#usereducer) ãƒ•ãƒƒã‚¯ã‚’ä½¿ãˆã°ã€è¤‡æ•°ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’æ·±ã„éšå±¤ã«å—ã‘æ¸¡ã—ã¦ã„ãå¿…è¦ãŒã‚ã¾ã‚Šãªããªã‚Šã¾ã™

### ã©ã†ã™ã‚Œã°è¤‡æ•°ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’æ·±ãå—ã‘æ¸¡ã™ã®ã‚’å›é¿ã§ãã¾ã™ã‹ï¼Ÿ {#how-to-avoid-passing-callbacks-down}

æˆ‘ã€…ãŒè¦‹ãŸã¨ã“ã‚ã€ã»ã¨ã‚“ã©ã®äººã¯ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ„ãƒªãƒ¼ã®å„éšå±¤ã§æ‰‹ä½œæ¥­ã§ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’å—ã‘æ¸¡ã—ã—ã¦ã„ãä½œæ¥­ãŒå¥½ãã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ãã‚Œã¯ã‚ˆã‚Šæ˜ç¤ºçš„ã§ã¯ã‚ã‚Šã¾ã™ãŒã€é¢å€’ãªã€é…ç®¡å·¥äº‹ã€ã‚’ã—ã¦ã„ã‚‹æ°—åˆ†ã«ãªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

å¤§ããªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ„ãƒªãƒ¼ã«ãŠã„ã¦æˆ‘ã€…ãŒãŠå‹§ã‚ã™ã‚‹ä»£æ›¿æ‰‹æ®µã¯ã€[`useReducer`](/docs/hooks-reference.html#usereducer) ã§ `dispatch` é–¢æ•°ã‚’ä½œã£ã¦ã€ãã‚Œã‚’ã‚³ãƒ³ãƒ†ã‚¯ã‚¹ãƒˆçµŒç”±ã§ä¸‹ã®éšå±¤ã«æ¸¡ã™ã€ã¨ã„ã†ã‚‚ã®ã§ã™ã€‚

```js{4,5}
const TodosDispatch = React.createContext(null);

function TodosApp() {
  // Note: `dispatch` won't change between re-renders
  const [todos, dispatch] = useReducer(todosReducer);

  return (
    <TodosDispatch.Provider value={dispatch}>
      <DeepTree todos={todos} />
    </TodosDispatch.Provider>
  );
}
```

`TodosApp` ãƒ„ãƒªãƒ¼ã®ä¸­ã«ã„ã‚‹ã‚ã‚‰ã‚†ã‚‹å­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ã“ã® `dispatch` é–¢æ•°ã‚’ä½¿ã†ã“ã¨ãŒã§ãã€ä¸Šä½ã«ã„ã‚‹ `TodosApp` ã«ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä¼ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```js{2,3}
function DeepChild(props) {
  // If we want to perform an action, we can get dispatch from context.
  const dispatch = useContext(TodosDispatch);

  function handleClick() {
    dispatch({ type: 'add', text: 'hello' });
  }

  return (
    <button onClick={handleClick}>Add todo</button>
  );
}
```

ã“ã‚Œã¯ï¼ˆè¤‡æ•°ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’ä½•åº¦ã‚‚å—ã‘æ¸¡ã—ã™ã‚‹å¿…è¦ãŒãªã„ã®ã§ï¼‰ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®è¦³ç‚¹ã‹ã‚‰ä¾¿åˆ©ã ã€ã¨ã„ã†ã ã‘ã§ã¯ãªãã€ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã«ã¾ã¤ã‚ã‚‹å•é¡Œã‚’ã™ã¹ã¦å›é¿ã§ãã¾ã™ã€‚æ·±ã„æ›´æ–°ã«ãŠã„ã¦ã¯ã“ã®ã‚ˆã†ã« `dispatch` ã‚’æ¸¡ã™ã®ãŒãŠå‹§ã‚ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã™ã€‚

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã® **state** ã«ã¤ã„ã¦ã¯ã€props ã¨ã—ã¦æ¸¡ã—ã¦ã„ãã‹ï¼ˆã‚ˆã‚Šæ˜ç¤ºçš„ï¼‰ã€ã‚ã‚‹ã„ã¯ã‚³ãƒ³ãƒ†ã‚¯ã‚¹ãƒˆçµŒç”±ã§æ¸¡ã™ã‹ï¼ˆæ·±ã„æ›´æ–°ã§ã¯ã‚ˆã‚Šä¾¿åˆ©ï¼‰ã‚’é¸ã¶ä½™åœ°ãŒä¾ç„¶ã‚ã‚Šã¾ã™ã€‚ã‚‚ã—ã‚‚ã‚³ãƒ³ãƒ†ã‚¯ã‚¹ãƒˆã‚’ä½¿ã£ã¦ state ã‚‚æ¸¡ã™ã“ã¨ã«ã™ã‚‹å ´åˆã¯ã€2 ã¤ã®åˆ¥ã®ã‚³ãƒ³ãƒ†ã‚¯ã‚¹ãƒˆã®ã‚¿ã‚¤ãƒ—ã‚’ä½¿ã£ã¦ãã ã•ã„ -- `dispatch` ã®ã‚³ãƒ³ãƒ†ã‚¯ã‚¹ãƒˆã¯æ±ºã—ã¦å¤‰ã‚ã‚‰ãªã„ãŸã‚ã€`dispatch` ã ã‘ã‚’ä½¿ã†ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ï¼ˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã® state ã‚‚å¿…è¦ã§ãªã„é™ã‚Šï¼‰å†ãƒ¬ãƒ³ãƒ€ãƒ¼ã™ã‚‹å¿…è¦ãŒãªããªã‚Šã¾ã™ã€‚

### `useCallback` ã‹ã‚‰ã®é »ç¹ã«å¤‰ã‚ã‚‹å€¤ã‚’èª­ã¿å‡ºã™æ–¹æ³•ã¯ï¼Ÿ {#how-to-read-an-often-changing-value-from-usecallback}

> è£œè¶³
>
> æˆ‘ã€…ã¯å€‹åˆ¥ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’ props ã¨ã—ã¦æ¸¡ã™ã®ã§ã¯ãªãã€[ã‚³ãƒ³ãƒ†ã‚¯ã‚¹ãƒˆçµŒç”±ã§ `dispatch` ã‚’æ¸¡ã™](#how-to-avoid-passing-callbacks-down)ã“ã¨ã‚’æ¨å¥¨ã—ã¦ã„ã¾ã™ã€‚ä»¥ä¸‹ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¯ç¶²ç¾…æ€§ã¨é¿é›£ãƒãƒƒãƒã®ç›®çš„ã§æ²è¼‰ã—ã¦ã„ã‚‹ã‚‚ã®ã§ã™ã€‚
>
> ã¾ãŸã€[concurrent mode](/blog/2018/03/27/update-on-async-rendering.html) ã«ãŠã„ã¦ã“ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯å•é¡Œã‚’èµ·ã“ã™å¯èƒ½æ€§ãŒã‚ã‚‹ã“ã¨ã«ã‚‚æ³¨æ„ã—ã¦ãã ã•ã„ã€‚å°†æ¥çš„ã«ã¯ã‚ˆã‚Šä½¿ã„ã‚„ã™ã„ä»£æ›¿æ‰‹æ®µã‚’æä¾›ã™ã‚‹ã“ã¨ã‚’è¨ˆç”»ã—ã¦ã„ã¾ã™ãŒã€ç¾æ™‚ç‚¹ã§ã®æœ€ã‚‚å®‰å…¨ãªè§£æ±ºæ³•ã¯ã€ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒä¾å­˜ã—ã¦ã„ã‚‹ä½•ã‚‰ã‹ã®å€¤ãŒå¤‰ã‚ã£ãŸå ´åˆã¯ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’ç„¡åŠ¹åŒ–ã—ã¦ä½œã‚Šç›´ã™ã“ã¨ã§ã™ã€‚

ç¨€ãªã‚±ãƒ¼ã‚¹ã§ã™ãŒã€ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’ [`useCallback`](/docs/hooks-reference.html#usecallback) ã§ãƒ¡ãƒ¢åŒ–ã—ã¦ã„ã‚‹ã«ã‚‚é–¢ã‚ã‚‰ãšã€å†…éƒ¨é–¢æ•°ã‚’ä½•åº¦ã‚‚å†ä½œæˆã—ãªã„ã¨ã„ã‘ãªã„ãŸã‚ãƒ¡ãƒ¢åŒ–ãŒã†ã¾ãåƒã‹ãªã„ã€ã¨ã„ã†ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ã‚ãªãŸãŒãƒ¡ãƒ¢åŒ–ã—ã‚ˆã†ã¨ã—ã¦ã„ã‚‹é–¢æ•°ãŒãƒ¬ãƒ³ãƒ€ãƒ¼æœ€ä¸­ã«ã¯ä½¿ã‚ã‚Œãªã„ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ãªã®ã§ã‚ã‚Œã°ã€[ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å¤‰æ•°ã¨ã—ã¦ã® ref](#is-there-something-like-instance-variables) ã‚’ä½¿ã£ã¦æœ€å¾Œã«ä½¿ã‚ã‚ŒãŸå€¤ã‚’æ‰‹å‹•ã§ä¿æŒã—ã¦ãŠãã“ã¨ãŒã§ãã¾ã™ã€‚

```js{6,10}
function Form() {
  const [text, updateText] = useState('');
  const textRef = useRef();

  useEffect(() => {
    textRef.current = text; // Write it to the ref
  });

  const handleSubmit = useCallback(() => {
    const currentText = textRef.current; // Read it from the ref
    alert(currentText);
  }, [textRef]); // Don't recreate handleSubmit like [text] would do

  return (
    <>
      <input value={text} onChange={e => updateText(e.target.value)} />
      <ExpensiveTree onSubmit={handleSubmit} />
    </>
  );
}
```

ã“ã‚Œã¯ã‚„ã‚„è¤‡é›‘ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã™ãŒã€ã“ã®ã‚ˆã†ãªé¿é›£ãƒãƒƒãƒçš„æœ€é©åŒ–ã¯å¿…è¦ã§ã‚ã‚Œã°å¯èƒ½ã ã¨ã„ã†ã“ã¨ã§ã™ã€‚ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã«æŠ½å‡ºã™ã‚Œã°å¤šå°‘ã¯èª­ã¿ã‚„ã™ããªã‚Šã¾ã™ï¼š

```js{4,16}
function Form() {
  const [text, updateText] = useState('');
  // Will be memoized even if `text` changes:
  const handleSubmit = useEventCallback(() => {
    alert(text);
  }, [text]);

  return (
    <>
      <input value={text} onChange={e => updateText(e.target.value)} />
      <ExpensiveTree onSubmit={handleSubmit} />
    </>
  );
}

function useEventCallback(fn, dependencies) {
  const ref = useRef(() => {
    throw new Error('Cannot call an event handler while rendering.');
  });

  useEffect(() => {
    ref.current = fn;
  }, [fn, ...dependencies]);

  return useCallback(() => {
    const fn = ref.current;
    return fn();
  }, [ref]);
}
```

ã„ãšã‚Œã«ã›ã‚ˆã€**ã“ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯è–¦ã‚ã‚‰ã‚Œãš**ã€ç¶²ç¾…æ€§ã®ãŸã‚ã«ç¤ºã—ã¦ã„ã‚‹ã«éãã¾ã›ã‚“ã€‚ä»£ã‚ã‚Šã«[ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’æ·±ãå—ã‘æ¸¡ã—ã¦ã„ãã“ã¨ã‚’å›é¿ã™ã‚‹](#how-to-avoid-passing-callbacks-down)ã®ãŒæœ›ã¾ã—ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã™ã€‚


## å†…éƒ¨ã®ä»•çµ„ã¿ {#under-the-hood}

### React ã¯ãƒ•ãƒƒã‚¯å‘¼ã³å‡ºã—ã¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã‚’ã©ã®ã‚ˆã†ã«é–¢é€£ä»˜ã‘ã¦ã„ã‚‹ã®ã§ã™ã‹ï¼Ÿ {#how-does-react-associate-hook-calls-with-components}

React ã¯ç¾åœ¨ã©ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒãƒ¬ãƒ³ãƒ€ãƒ¼ä¸­ãªã®ã‹ã‚’æŠŠæ¡ã—ã¦ã„ã¾ã™ã€‚[ãƒ•ãƒƒã‚¯ã®ãƒ«ãƒ¼ãƒ«](/docs/hooks-rules.html)ã®ãŠé™°ã§ã€ãƒ•ãƒƒã‚¯ã¯ React ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ï¼ˆã‚ã‚‹ã„ã¯ãã‚Œã‚‰ã‹ã‚‰å‘¼ã³å‡ºã•ã‚Œã‚‹ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯å†…ï¼‰ã§ã®ã¿å‘¼ã³å‡ºã•ã‚Œã‚‹ã¨ã„ã†ã“ã¨ãŒåˆ†ã‹ã£ã¦ã„ã¾ã™ã€‚

ãã‚Œãã‚Œã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«é–¢é€£ä»˜ã‘ã‚‰ã‚Œã‚‹å½¢ã§ã€React å†…ã«ã€Œãƒ¡ãƒ¢ãƒªãƒ¼ã‚»ãƒ«ã€ã®ãƒªã‚¹ãƒˆãŒå­˜åœ¨ã—ã¦ã„ã¾ã™ã€‚ãã‚Œã‚‰ã¯å˜ã«ä½•ã‚‰ã‹ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã§ãã‚‹ JavaScript ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚ã‚ãªãŸãŒ `useState()` ã®ã‚ˆã†ãªãƒ•ãƒƒã‚¯ã‚’å‘¼ã¶ã¨ã€ãƒ•ãƒƒã‚¯ã¯ç¾åœ¨ã®ã‚»ãƒ«ã®å€¤ã‚’èª­ã¿å‡ºã—ï¼ˆã‚ã‚‹ã„ã¯åˆå›ãƒ¬ãƒ³ãƒ€ãƒ¼æ™‚ã¯ã‚»ãƒ«å†…å®¹ã‚’åˆæœŸåŒ–ã—ï¼‰ã€ãƒã‚¤ãƒ³ã‚¿ã‚’æ¬¡ã«é€²ã‚ã¾ã™ã€‚ã“ã‚ŒãŒè¤‡æ•°ã® `useState()` ã®å‘¼ã³å‡ºã—ãŒå€‹åˆ¥ã®ãƒ­ãƒ¼ã‚«ãƒ« state ã‚’å¾—ã‚‹ä»•çµ„ã¿ã§ã™ã€‚

### ãƒ•ãƒƒã‚¯ã®å…ˆè¡ŒæŠ€è¡“ã«ã¯ã©ã®ã‚ˆã†ãªã‚‚ã®ãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿ {#what-is-the-prior-art-for-hooks}

ãƒ•ãƒƒã‚¯ã¯è¤‡æ•°ã®ç•°ãªã£ãŸå‡ºå…¸ã‹ã‚‰ã®ã‚¢ã‚¤ãƒ‡ã‚£ã‚¢ã‚’ç·åˆã—ãŸã‚‚ã®ã§ã™ï¼š

* [react-future](https://github.com/reactjs/react-future/tree/master/07%20-%20Returning%20State) ãƒªãƒã‚¸ãƒˆãƒªã«ãŠã‘ã‚‹é–¢æ•°å‹ API ã®å¤ã„å®Ÿé¨“ã€‚
* [Ryan Florence](https://github.com/ryanflorence) ã® [Reactions Component](https://github.com/reactions/component) ã‚’å«ã‚€ã€React ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã®ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ—ãƒ­ãƒƒãƒ— API ã«é–¢ã™ã‚‹å®Ÿé¨“ã€‚
* [Dominic Gannaway](https://github.com/trueadm) ã«ã‚ˆã£ã¦ææ¡ˆã•ã‚ŒãŸã€ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ—ãƒ­ãƒƒãƒ—ã®ç³–è¡£æ§‹æ–‡ã¨ã—ã¦ã® [`adopt` keyword](https://gist.github.com/trueadm/17beb64288e30192f3aa29cad0218067)ã€‚
* [DisplayScript](http://displayscript.org/introduction.html) ã®ã‚¹ãƒ†ãƒ¼ãƒˆå¤‰æ•°ã¨ã‚¹ãƒ†ãƒ¼ãƒˆã‚»ãƒ«ã€‚
* ReasonReact ã® [Reducer components](https://reasonml.github.io/reason-react/docs/en/state-actions-reducer.html)ã€‚
* Rx ã® [Subscriptions](http://reactivex.io/rxjs/class/es6/Subscription.js~Subscription.html)ã€‚
* Multicore OCaml ã® [Algebraic effects](https://github.com/ocamllabs/ocaml-effects-tutorial#2-effectful-computations-in-a-pure-setting)ã€‚

ãƒ•ãƒƒã‚¯ã¯ [Sebastian MarkbÃ¥ge](https://github.com/sebmarkbage) ãŒæœ€åˆã®ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’ä½œã‚Šã€[Andrew Clark](https://github.com/acdlite)ã€[Sophie Alpert](https://github.com/sophiebits)ã€[Dominic Gannaway](https://github.com/trueadm) ãŠã‚ˆã³ãã®ä»–ã® React ãƒãƒ¼ãƒ ã®ãƒ¡ãƒ³ãƒãƒ¼ãŒæ´—ç·´ã•ã›ã¾ã—ãŸã€‚
